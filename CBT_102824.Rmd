---
title: "CBTanalysis_KAL"
output:
  word_document: default
  html_document: default
  pdf_document: default
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## How does a single light-dark inversion affect body temperature in mice with or without access to a running wheel?

In an earlier experiment, Amanda Roberts collected data that seemed to suggest a very slow adjustment of circadian entrainment after a light-dark inversion in contrast to prior literature and our own experience measuring re-entrainment in mice housed in running wheel cages. So, Andrea Ciorciari set up an experiment to measure re-entrainment using core body temperature and metabolic cage data in mice that were given access to a running wheel or housed in standard conditions.

Emanuel Irizarry implanted Anipill capsules (BodyCAP, Inc.) to continuously record core body temperature in male c57BL/6J mice. Surgeries were performed in January 2024 and mice recovered for ____ before being placed in light-controlled conditions in February 2024. On Saturday 2/10/24, the lighting schedule was changed from lights ON at 3am and OFF at 3pm, to lights ON at 3pm and lights OFF at 3am (a 12-hour phase shift, a.k.a. light-dark inversion). That day, mice in the RW group were provided running wheels. 

The first CLAMS test was done from 2/5/24 through 2/10/24.
The second CLAMS test was done from 2/26/24 through 3/1/24.

```{r load packages, include=FALSE, echo=FALSE}

Sys.setenv(TZ = "UTC")

library(gsignal)
library(zoo)
library(tidyverse)
library(dplyr)
library(lubridate)
library(ggplot2)
library(rstatix)
library(ggpubr)
library(knitr)

```


```{r read in data, include=FALSE, echo=FALSE}
#NB: The raw data files from Anipill include characters with problematic coding so they need to be saved as "CSV UTF-8" format files to be read in properly here.
#NB: Andrea's data has dates in day-month-year and temperatures use comma instead of "." for decimal so need to convert all prior to analysis.

Data1 <- read.csv("Week4converted.csv")
DataA <- read.csv("Week4Aconverted.csv")

```


```{r wrangle data, include=FALSE, echo=FALSE}

Names <- c("Date", "Time", "CBT")

Dat1_1 <- Data1[-c(1:6),] %>% select(2:4)
names(Dat1_1) <- Names
Dat1_1$CBT <- as.numeric(Dat1_1$CBT)
Dat1_1$mouse <- 1
Dat1_1$Group <- "RW"

Dat1_2 <- Data1[-c(1:6),] %>% select(9:11)
names(Dat1_2) <- Names
Dat1_2$CBT <- as.numeric(Dat1_2$CBT)
Dat1_2$mouse <- 2
Dat1_2$Group <- "RW"

Dat1_3 <- Data1[-c(1:6),] %>% select(16:18)
names(Dat1_3) <- Names
Dat1_3$CBT <- as.numeric(Dat1_3$CBT)
Dat1_3$mouse <- 3
Dat1_3$Group <- "RW"

Dat1_4 <- Data1[-c(1:6),] %>% select(23:25)
names(Dat1_4) <- Names
Dat1_4$CBT <- as.numeric(Dat1_4$CBT)
Dat1_4$mouse <- 4
Dat1_4$Group <- "RW"

Dat1_5 <- Data1[-c(1:6),] %>% select(30:32)
names(Dat1_5) <- Names
Dat1_5$CBT <- as.numeric(Dat1_5$CBT)
Dat1_5$mouse <- 5
Dat1_5$Group <- "RW"

Dat1_6 <- Data1[-c(1:6),] %>% select(37:39)
names(Dat1_6) <- Names
Dat1_6$CBT <- as.numeric(Dat1_6$CBT)
Dat1_6$mouse <- 6
Dat1_6$Group <- "RW"

Dat1_7 <- Data1[-c(1:6),] %>% select(44:46)
names(Dat1_7) <- Names
Dat1_7$CBT <- as.numeric(Dat1_7$CBT)
Dat1_7$mouse <- 7
Dat1_7$Group <- "RW"

Dat1_8 <- Data1[-c(1:6),] %>% select(51:53)
names(Dat1_8) <- Names
Dat1_8$CBT <- as.numeric(Dat1_8$CBT)
Dat1_8$mouse <- 8
Dat1_8$Group <- "RW"

DatA_1 <- DataA[-c(1:6),] %>% select(2:4)
names(DatA_1) <- Names
DatA_1$CBT <- as.numeric(DatA_1$CBT)
DatA_1$mouse <- 9
DatA_1$Group <- "CTRL"

DatA_2 <- DataA[-c(1:6),] %>% select(9:11)
names(DatA_2) <- Names
DatA_2$CBT <- as.numeric(DatA_2$CBT)
DatA_2$mouse <- 10
DatA_2$Group <- "CTRL"

DatA_3 <- DataA[-c(1:6),] %>% select(16:18)
names(DatA_3) <- Names
DatA_3$CBT <- as.numeric(DatA_3$CBT)
DatA_3$mouse <- 11
DatA_3$Group <- "CTRL"

DatA_4 <- DataA[-c(1:6),] %>% select(23:25)
names(DatA_4) <- Names
DatA_4$CBT <- as.numeric(DatA_4$CBT)
DatA_4$mouse <- 12
DatA_4$Group <- "CTRL"

DatA_5 <- DataA[-c(1:6),] %>% select(30:32)
names(DatA_5) <- Names
DatA_5$CBT <- as.numeric(DatA_5$CBT)
DatA_5$mouse <- 13
DatA_5$Group <- "CTRL"

DatA_6 <- DataA[-c(1:6),] %>% select(37:39)
names(DatA_6) <- Names
DatA_6$CBT <- as.numeric(DatA_6$CBT)
DatA_6$mouse <- 14
DatA_6$Group <- "CTRL"

DatA_7 <- DataA[-c(1:6),] %>% select(44:46)
names(DatA_7) <- Names
DatA_7$CBT <- as.numeric(DatA_7$CBT)
DatA_7$mouse <- 15
DatA_7$Group <- "CTRL"


```


```{r correct dates and times that were not programmed correctly, include=FALSE, echo=FALSE}

TrueStart <- ymd_hms("2024-02-05 11:00:00 UTC")
Programmed1 <- ymd_hms("2023-10-06 00:49:00 UTC") # Everything looks like it's three hours off. Try changing this by 3 hours?
ProgrammedA <- ymd_hms("2023-11-22 19:36:00 UTC") # Did Andrea choose the corrections when he was assuming LD from 6a-6p?

correction1 <- TrueStart - Programmed1
correctionA <- TrueStart - ProgrammedA

```

CBT data collection began at `r TrueStart`. The Anipill monitors were not programmed correctly to set the date and time so the original data start at:

Group 1 (RW group): `r Programmed1`
Group A (CTRL group): `r ProgrammedA`

These values were corrected computationally by subtracting the appropriate constant date/time difference from all recorded values in each group.

```{r create master data frame and exclude extraneous data, include=FALSE, echo=FALSE}

# Combine all data in one data frame

DatCombined1 <- rbind(Dat1_1, Dat1_2, Dat1_3, Dat1_4, Dat1_5, Dat1_6, Dat1_7, Dat1_8)
DatCombinedA <- rbind(DatA_1, DatA_2, DatA_3, DatA_4, DatA_5, DatA_6, DatA_7)

# Remove outliers defined by low CBT (likely during recovery from surgery)

LoTemp <- 34
DatCombined1$CBT <- ifelse(DatCombined1$CBT > LoTemp, DatCombined1$CBT, NA)
DatCombinedA$CBT <- ifelse(DatCombinedA$CBT > LoTemp, DatCombinedA$CBT, NA)

# Add variables to define and correct time of day

DatComb1corrected <- mutate(DatCombined1, datetime = dmy_hms(paste(Date,Time))) %>%
  mutate(datetime_corr = datetime + correction1) %>%
  mutate(Hour = hour(datetime_corr)) %>%
  mutate(TimeOfDay = hour(datetime_corr) +
           minute(datetime_corr)/60 +
           second(datetime_corr)/3600) 

DatCombAcorrected <- mutate(DatCombinedA, datetime = dmy_hms(paste(Date,Time))) %>%
  mutate(datetime_corr = datetime + correctionA) %>%
  mutate(Hour = hour(datetime_corr)) %>%
  mutate(TimeOfDay = hour(datetime_corr) +
           minute(datetime_corr)/60 +
           second(datetime_corr)/3600) 

# Combine all data into one dataframe

DatCombinedALL <- rbind(DatComb1corrected, DatCombAcorrected)

# Remove data outside dates of interest

ExpStart <- dmy("25-01-2024")
ExpEnd <- dmy("04-03-2024")

# Add variable to define days before and after the inversion
DatCombinedALL$CorrectDate = date(DatCombinedALL$datetime_corr)

DatCombinedALL <- DatCombinedALL %>% filter(CorrectDate > ExpStart)
DatCombinedALL <- DatCombinedALL %>% filter(CorrectDate < ExpEnd)

# Add variables to define lights on and off and Andrea's time windows

DatCombinedALL <- DatCombinedALL %>%
  mutate(ExpPhase = ifelse(datetime_corr > dmy("05-02-2024") & datetime_corr < dmy("11-02-2024"), "T0", NA))
DatCombinedALL$ExpPhase = 
  ifelse(DatCombinedALL$datetime_corr > dmy("11-02-2024") & DatCombinedALL$datetime_corr < dmy("14-02-2024"),
         "T1", DatCombinedALL$ExpPhase)
DatCombinedALL$ExpPhase = 
  ifelse(DatCombinedALL$datetime_corr > dmy("15-02-2024") & DatCombinedALL$datetime_corr < dmy("18-02-2024"),
         "T2", DatCombinedALL$ExpPhase)
DatCombinedALL$ExpPhase = 
  ifelse(DatCombinedALL$datetime_corr > dmy("19-02-2024") & DatCombinedALL$datetime_corr < dmy("22-02-2024"),
         "T3", DatCombinedALL$ExpPhase)
DatCombinedALL$ExpPhase = 
  ifelse(DatCombinedALL$datetime_corr > dmy("22-02-2024") & DatCombinedALL$datetime_corr < dmy("25-02-2024"),
         "T4", DatCombinedALL$ExpPhase)
DatCombinedALL$ExpPhase = 
  ifelse(DatCombinedALL$datetime_corr > dmy("27-02-2024") & DatCombinedALL$datetime_corr < dmy("01-03-2024"),
         "T5", DatCombinedALL$ExpPhase)
DatCombinedALL$ExpPhase = 
  ifelse(DatCombinedALL$datetime_corr > dmy("01-03-2024") & DatCombinedALL$datetime_corr < dmy("04-03-2024"),
         "T6", DatCombinedALL$ExpPhase)

# Add variable to define days before and after the inversion
DatCombinedALL$CorrectDate = date(DatCombinedALL$datetime_corr)

DatCombinedALL <- DatCombinedALL %>%
  mutate(RelativeDay = ifelse(CorrectDate == "2024-02-10", "LDI", NA))
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-03", "LDI-7", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-04", "LDI-6", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-05", "LDI-5", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-06", "LDI-4", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-07", "LDI-3", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-08", "LDI-2", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-09", "LDI-1", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-11", "LDI+1", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-12", "LDI+2", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-13", "LDI+3", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-14", "LDI+4", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-15", "LDI+5", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-16", "LDI+6", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-17", "LDI+7", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-18", "LDI+8", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-19", "LDI+9", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-20", "LDI+10", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-21", "LDI+11", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-22", "LDI+12", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-23", "LDI+13", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-24", "LDI+14", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-25", "LDI+15", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-26", "LDI+16", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-27", "LDI+17", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-28", "LDI+18", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-02-29", "LDI+19", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-03-01", "LDI+20", DatCombinedALL$RelativeDay)
DatCombinedALL$RelativeDay = 
  ifelse(DatCombinedALL$CorrectDate == "2024-03-02", "LDI+21", DatCombinedALL$RelativeDay)

DatCombALL_Corrected <- DatCombinedALL %>% select(CorrectDate,
                                                  TimeOfDay,
                                                  datetime_corr,
                                                  mouse,
                                                  Group,
                                                  ExpPhase,
                                                  RelativeDay,
                                                  CBT)

# Add factor to define lights on and off

DatCombALL_Corrected$Light <- ifelse(
  (DatCombALL_Corrected$CorrectDate < "2024-02-10"),
  ifelse((DatCombALL_Corrected$TimeOfDay < 3 |
            DatCombALL_Corrected$TimeOfDay > 15),
         "OFF", "ON"), NA)
DatCombALL_Corrected$Light <- ifelse(
  (DatCombALL_Corrected$CorrectDate > "2024-02-10"),
  ifelse((DatCombALL_Corrected$TimeOfDay < 3 |
            DatCombALL_Corrected$TimeOfDay > 15),
         "ON", "OFF"), DatCombALL_Corrected$Light)
DatCombALL_Corrected$Light <- ifelse(
  (DatCombALL_Corrected$CorrectDate == "2024-02-10"),
  ifelse((DatCombALL_Corrected$TimeOfDay < 3 |
            DatCombALL_Corrected$TimeOfDay > 10 &
            DatCombALL_Corrected$TimeOfDay < 15),
         "OFF", "ON"), DatCombALL_Corrected$Light)

```

For the purposes of comparing body temperatures collected during light and dark phases prior to the light-dark inversion, we define DAY as ZT2-ZT10 and NIGHT as ZT14-ZT22.  (And corresponds to 5am-1pm for DAY and 5pm to 1am for NIGHT).

```{r statistics for T0 through T6, echo=FALSE}

# Calculate group statistics for experimental phases

Summ <- summarise(DatCombALL_Corrected %>% filter(ExpPhase == "T0" |
                                                    ExpPhase == "T1" |
                                                    ExpPhase == "T2") %>%
                    group_by(ExpPhase, Group) %>%
                    drop_na(),
                  mean = mean(CBT),
                  median = median(CBT),
                  sd = sd(CBT))

# Use levene's test of equal variance:

ltest_Group <- DatCombALL_Corrected %>% filter(ExpPhase == "T0" |
                                                    ExpPhase == "T1" |
                                                    ExpPhase == "T2") %>% levene_test(CBT ~ Group)

ltest_Phase <- DatCombALL_Corrected %>% filter(ExpPhase == "T0" |
                                                    ExpPhase == "T1" |
                                                    ExpPhase == "T2") %>% levene_test(CBT ~ ExpPhase)

Dat_T0 <- DatCombALL_Corrected %>% filter(ExpPhase == "T0")
Dat_T1 <- DatCombALL_Corrected %>% filter(ExpPhase == "T1")
Dat_T2 <- DatCombALL_Corrected %>% filter(ExpPhase == "T2")
Dat_T3 <- DatCombALL_Corrected %>% filter(ExpPhase == "T3")
Dat_T4 <- DatCombALL_Corrected %>% filter(ExpPhase == "T4")
Dat_T5 <- DatCombALL_Corrected %>% filter(ExpPhase == "T5")
Dat_T6 <- DatCombALL_Corrected %>% filter(ExpPhase == "T6")

# Two-way ANOVA tests with Tukey's post-hoc analysis for corrected p values.

DatT0groupedMS <- Dat_T0 %>% group_by(mouse, Group, Light) %>% drop_na()
SummT0 <- summarise(DatT0groupedMS,
                    meanCBT = mean(CBT))

TwoWayTukeyT0 <- aov(meanCBT ~ Light*Group, data = SummT0) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyT0[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for experimental phase T0 (baseline)")


DatT1groupedMS <- Dat_T1 %>% group_by(mouse, Group, Light) %>% drop_na()
SummT1 <- summarise(DatT1groupedMS,
                    meanCBT = mean(CBT))

TwoWayTukeyT1 <- aov(meanCBT ~ Light*Group, data = SummT1) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyT1[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for experimental phase T1 (LDI+1 thru LDI+3)")

DatT2groupedMS <- Dat_T2 %>% group_by(mouse, Group, Light) %>% drop_na()
SummT2 <- summarise(DatT2groupedMS,
                    meanCBT = mean(CBT))

TwoWayTukeyT2 <- aov(meanCBT ~ Light*Group, data = SummT2) %>% tukey_hsd() %>% add_significance()

TwoWayTukeyT2 <- aov(CBT ~ Light*Group, data = Dat_T2) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyT2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for experimental phase T2 (LDI+5 thru LDI+7)")

DatT3groupedMS <- Dat_T3 %>% group_by(mouse, Group, Light) %>% drop_na()
SummT3 <- summarise(DatT3groupedMS,
                    meanCBT = mean(CBT))

TwoWayTukeyT3 <- aov(meanCBT ~ Light*Group, data = SummT3) %>% tukey_hsd() %>% add_significance()

TwoWayTukeyT3 <- aov(CBT ~ Light*Group, data = Dat_T3) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyT3[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for experimental phase T3 (LDI+8 thru LDI+10)")

DatT4groupedMS <- Dat_T4 %>% group_by(mouse, Group, Light) %>% drop_na()
SummT4 <- summarise(DatT4groupedMS,
                    meanCBT = mean(CBT))

TwoWayTukeyT4 <- aov(meanCBT ~ Light*Group, data = SummT4) %>% tukey_hsd() %>% add_significance()

TwoWayTukeyT4 <- aov(CBT ~ Light*Group, data = Dat_T4) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyT2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for experimental phase T4 (LDI+11 thru LDI+13)")

DatT5groupedMS <- Dat_T5 %>% group_by(mouse, Group, Light) %>% drop_na()
SummT5 <- summarise(DatT5groupedMS,
                    meanCBT = mean(CBT))

TwoWayTukeyT5 <- aov(meanCBT ~ Light*Group, data = SummT5) %>% tukey_hsd() %>% add_significance()

TwoWayTukeyT5 <- aov(CBT ~ Light*Group, data = Dat_T5) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyT5[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for experimental phase T5 (LDI+16 thru LDI+18)")

DatT6groupedMS <- Dat_T6 %>% group_by(mouse, Group, Light) %>% drop_na()
SummT6 <- summarise(DatT6groupedMS,
                    meanCBT = mean(CBT))

TwoWayTukeyT6 <- aov(meanCBT ~ Light*Group, data = SummT6) %>% tukey_hsd() %>% add_significance()

TwoWayTukeyT6 <- aov(CBT ~ Light*Group, data = Dat_T6) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyT2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for experimental phase T6 (LDI+19 thru LDI+21)")

```



```{r boxplots, fig.width=2.5,fig.height=1.8}

SummT0$Group <- factor(SummT0$Group, levels = c("CTRL","RW"))
SummT0$Light <- factor(SummT0$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummT0 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "T0 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummT0 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "T0 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

# T1
SummT1$Group <- factor(SummT1$Group, levels = c("CTRL","RW"))
SummT1$Light <- factor(SummT1$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummT1 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "T1 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummT1 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "T1 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

#T2
SummT2$Group <- factor(SummT2$Group, levels = c("CTRL","RW"))
SummT2$Light <- factor(SummT2$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummT2 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "T2 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummT2 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "T2 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

#T3
SummT3$Group <- factor(SummT3$Group, levels = c("CTRL","RW"))
SummT3$Light <- factor(SummT3$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummT3 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "T3 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummT3 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "T3 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

#T4
SummT4$Group <- factor(SummT4$Group, levels = c("CTRL","RW"))
SummT4$Light <- factor(SummT4$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummT4 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "T4 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummT4 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "T4 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()


#T5
SummT5$Group <- factor(SummT5$Group, levels = c("CTRL","RW"))
SummT5$Light <- factor(SummT5$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummT5 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "T5 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummT5 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "T5 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()


# T6
SummT6$Group <- factor(SummT6$Group, levels = c("CTRL","RW"))
SummT6$Light <- factor(SummT6$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummT6 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "T6 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummT6 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "T6 (baseline)",
         y = "CBT (deg C)") +
  ylim(34,38) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()



```



```{r create CTRL time series, echo=FALSE, include=TRUE, fig.width=5,fig.height=3}

StartDate <- as.Date("2024-02-04")
EndDate <- as.Date(StartDate) + 28

SeriesData <- DatCombALL_Corrected %>% filter(CorrectDate > StartDate & CorrectDate < EndDate)
SeriesData$CBTtest <- na.approx(SeriesData$CBT)

LDI_Date <- as.Date("2024-02-10")
SeriesPRELDI <- SeriesData %>% filter(CorrectDate < LDI_Date)

SeriesT0 <- SeriesData %>% filter(ExpPhase == "T0")
SeriesT1 <- SeriesData %>% filter(ExpPhase == "T1")
SeriesT2 <- SeriesData %>% filter(ExpPhase == "T2")
SeriesT3 <- SeriesData %>% filter(ExpPhase == "T3")
SeriesT4 <- SeriesData %>% filter(ExpPhase == "T4")
SeriesT5 <- SeriesData %>% filter(ExpPhase == "T5")
SeriesT6 <- SeriesData %>% filter(ExpPhase == "T6")

# Pills were set to measure CBT every 5 minutes - that is probably why they ran out of battery.
# Frequency here is in minutes.
# For autocorrelation, need to limit to where there are no missing data. Use na.approx to fill in missing data. If too much missing data, exclude.

# For phase shift, set up CCF between SeriesT0 and each subsequent series and extract the phase with max correlation. 
# Could do this for each day if desired.

Pill <- 9

mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "CTRL"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "CTRL"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "CTRL"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "CTRL"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "CTRL"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "CTRL"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- ACFtib


Pill <- 10
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "CTRL"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "CTRL"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "CTRL"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "CTRL"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "CTRL"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "CTRL"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

Pill <- 11
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "CTRL"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "CTRL"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "CTRL"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "CTRL"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "CTRL"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "CTRL"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

Pill <- 12
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "CTRL"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "CTRL"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "CTRL"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "CTRL"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "CTRL"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "CTRL"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

Pill <- 13
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "CTRL"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "CTRL"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "CTRL"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "CTRL"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "CTRL"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "CTRL"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)



Pill <- 14
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "CTRL"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "CTRL"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "CTRL"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "CTRL"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "CTRL"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "CTRL"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


ACFcombCTRL_peaks <- ACFcombCTRL %>% filter(hours > 20 & hours < 30) %>%
  filter(ACF > 0.5)

SummACFcombCTRLpks <- summarise(ACFcombCTRL_peaks %>% group_by(portion),
                             meanPeriod = mean(hours),
                             sdPeriod = sd(hours),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))



```


Time series for all RW animals (pills 1,3,4,5,6,7,8).
Showing data for February 6, 2024, through March 5, 2024.

NOTE: Pill#2 did not record.
For records with sporadic missing data, they are approximated using na.approx() which calculates the values based on surrounding measurements.


```{r create RW time series, include=TRUE, fig.width=5,fig.height=3}


Pill <- 1
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "RW"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "RW"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "RW"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "RW"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "RW"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "RW"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombRW <- ACFtib


Pill <- 3
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "RW"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "RW"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "RW"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "RW"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "RW"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "RW"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

Pill <- 4
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "RW"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "RW"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "RW"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "RW"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "RW"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "RW"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

Pill <- 5
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "RW"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "RW"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "RW"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "RW"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "RW"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "RW"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

Pill <- 6
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "RW"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "RW"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "RW"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "RW"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "RW"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "RW"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

Pill <- 7
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "RW"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "RW"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "RW"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "RW"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "RW"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "RW"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

Pill <- 8
mousePRE <- SeriesPRELDI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mousePRE$CBT[1] = ifelse(is.na(mousePRE$CBT[1]),
                         mousePRE$CBT[2],
                         mousePRE$CBT[1])
mousePRE$CBT <- na.approx(mousePRE$CBT)
test <- mousePRE$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
testL <- mousePRE$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
PREacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
PREacftib <- as_tibble(cbind(PREacf$lag,PREacf$acf))
colnames(PREacftib) <- c("hours","ACF")
PREacftib <- PREacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(PREacftib$ACF)
PeriodACF <- PREacftib$hours[PREacftib$ACF == MAX]
PREacftib <- PREacftib %>% filter(hours == PeriodACF)
PREccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
PREccftib <- as_tibble(cbind(PREccf$lag,PREccf$acf))
colnames(PREccftib) <- c("hours","ACF")
PREccftib <- PREccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(PREccftib$ACF)
PhaseCCF <- PREccftib$hours[PREccftib$ACF == MAX]
PREacftib$PhaseCCF <- PhaseCCF
PREacftib$group <- "RW"
PREacftib$portion <- "PRE"


mouseT0 <- SeriesT0 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT0$CBT[1] = ifelse(is.na(mouseT0$CBT[1]),
                         mouseT0$CBT[2],
                         mouseT0$CBT[1])
mouseT0$CBT <- na.approx(mouseT0$CBT)
test <- mouseT0$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX]
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "T0"


mouseT1 <- SeriesT1 %>% filter(mouse == Pill)  %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT1$CBT[1] = ifelse(is.na(mouseT1$CBT[1]),
                         mouseT1$CBT[2],
                         mouseT1$CBT[1])
mouseT1$CBT <- na.approx(mouseT1$CBT)
test <- mouseT1$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT1 <- plot(ts_mouse)
testL <- mouseT1$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T1acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T1acftib <- as_tibble(cbind(T1acf$lag,T1acf$acf))
colnames(T1acftib) <- c("hours","ACF")
T1acftib <- T1acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T1acftib$ACF)
PeriodACF <- T1acftib$hours[T1acftib$ACF == MAX]
T1acftib <- T1acftib %>% filter(hours == PeriodACF)
T1ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T1ccftib <- as_tibble(cbind(T1ccf$lag,T1ccf$acf))
colnames(T1ccftib) <- c("hours","ACF")
T1ccftib <- T1ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T1ccftib$ACF)
PhaseCCF <- T1ccftib$hours[T1ccftib$ACF == MAX]
T1acftib$PhaseCCF <- PhaseCCF
T1acftib$group <- "RW"
T1acftib$portion <- "T1"


mouseT3 <- SeriesT3 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT3$CBT[1] = ifelse(is.na(mouseT3$CBT[1]),
                         mouseT3$CBT[2],
                         mouseT3$CBT[1])
mouseT3$CBT <- na.approx(mouseT3$CBT)
test <- mouseT3$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT3 <- plot(ts_mouse)
testL <- mouseT3$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T3acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T3acftib <- as_tibble(cbind(T3acf$lag,T3acf$acf))
colnames(T3acftib) <- c("hours","ACF")
T3acftib <- T3acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T3acftib$ACF)
PeriodACF <- T3acftib$hours[T3acftib$ACF == MAX]
T3acftib <- T3acftib %>% filter(hours == PeriodACF)
T3ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T3ccftib <- as_tibble(cbind(T3ccf$lag,T3ccf$acf))
colnames(T3ccftib) <- c("hours","ACF")
T3ccftib <- T3ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T3ccftib$ACF)
PhaseCCF <- T3ccftib$hours[T3ccftib$ACF == MAX]
T3acftib$PhaseCCF <- PhaseCCF
T3acftib$group <- "RW"
T3acftib$portion <- "T3"

mouseT2 <- SeriesT2 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT2$CBT[1] = ifelse(is.na(mouseT2$CBT[1]),
                         mouseT2$CBT[2],
                         mouseT2$CBT[1])
mouseT2$CBT <- na.approx(mouseT2$CBT)
test <- mouseT2$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT2 <- plot(ts_mouse)
testL <- mouseT2$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T2acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T2acftib <- as_tibble(cbind(T2acf$lag,T2acf$acf))
colnames(T2acftib) <- c("hours","ACF")
T2acftib <- T2acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T2acftib$ACF)
PeriodACF <- T2acftib$hours[T2acftib$ACF == MAX]
T2acftib <- T2acftib %>% filter(hours == PeriodACF)
T2ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T2ccftib <- as_tibble(cbind(T2ccf$lag,T2ccf$acf))
colnames(T2ccftib) <- c("hours","ACF")
T2ccftib <- T2ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T2ccftib$ACF)
PhaseCCF <- T2ccftib$hours[T2ccftib$ACF == MAX]
T2acftib$PhaseCCF <- PhaseCCF
T2acftib$group <- "RW"
T2acftib$portion <- "T2"

mouseT4 <- SeriesT4 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT4$CBT[1] = ifelse(is.na(mouseT4$CBT[1]),
                         mouseT4$CBT[2],
                         mouseT4$CBT[1])
mouseT4$CBT <- na.approx(mouseT4$CBT)
test <- mouseT4$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT4 <- plot(ts_mouse)
testL <- mouseT4$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T4acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T4acftib <- as_tibble(cbind(T4acf$lag,T4acf$acf))
colnames(T4acftib) <- c("hours","ACF")
T4acftib <- T4acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T4acftib$ACF)
PeriodACF <- T4acftib$hours[T4acftib$ACF == MAX]
T4acftib <- T4acftib %>% filter(hours == PeriodACF)
T4ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T4ccftib <- as_tibble(cbind(T4ccf$lag,T4ccf$acf))
colnames(T4ccftib) <- c("hours","ACF")
T4ccftib <- T4ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T4ccftib$ACF)
PhaseCCF <- T4ccftib$hours[T4ccftib$ACF == MAX]
T4acftib$PhaseCCF <- PhaseCCF
T4acftib$group <- "RW"
T4acftib$portion <- "T4"

mouseT5 <- SeriesT5 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT5$CBT[1] = ifelse(is.na(mouseT5$CBT[1]),
                         mouseT5$CBT[2],
                         mouseT5$CBT[1])
mouseT5$CBT <- na.approx(mouseT5$CBT)
test <- mouseT5$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX]
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "T5"

mouseT6 <- SeriesT6 %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseT6$CBT[1] = ifelse(is.na(mouseT6$CBT[1]),
                         mouseT6$CBT[2],
                         mouseT6$CBT[1])
mouseT6$CBT <- na.approx(mouseT6$CBT)
test <- mouseT6$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pT6 <- plot(ts_mouse)
testL <- mouseT6$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
T6acf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
T6acftib <- as_tibble(cbind(T6acf$lag,T6acf$acf))
colnames(T6acftib) <- c("hours","ACF")
T6acftib <- T6acftib %>% filter(hours > 18 & hours < 30)
MAX <- max(T6acftib$ACF)
PeriodACF <- T6acftib$hours[T6acftib$ACF == MAX]
T6acftib <- T6acftib %>% filter(hours == PeriodACF)
T6ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T6ccftib <- as_tibble(cbind(T6ccf$lag,T6ccf$acf))
colnames(T6ccftib) <- c("hours","ACF")
T6ccftib <- T6ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T6ccftib$ACF)
PhaseCCF <- T6ccftib$hours[T6ccftib$ACF == MAX]
T6acftib$PhaseCCF <- PhaseCCF
T6acftib$group <- "RW"
T6acftib$portion <- "T6"

ACFtib <- rbind(PREacftib,T0acftib,T1acftib,T2acftib,T3acftib,T4acftib,T5acftib,T6acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

ACFcombRW_peaks <- ACFcombRW %>% filter(hours > 20 & hours < 30) %>%
  filter(ACF > 0.5)

SummACFcombRWpks <- summarise(ACFcombRW_peaks %>% group_by(portion),
                             meanPeriod = mean(hours),
                             sdPeriod = sd(hours),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))

#write_excel_csv(ACF_ALL, "PeriodsPhases_ACFCCF.xls")

```

```{r boxplot for periods by group, fig.height=2, fig.width=3}

ACF_ALL <- rbind(ACFcombCTRL,ACFcombRW) %>% mutate(PeriodACF = hours)

SummACF <- summarise(ACF_ALL %>% group_by(group,portion),
                             meanPeriod = mean(hours),
                             sdPeriod = sd(hours),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))

data <- SummACF
knitr::kable(data, caption = "Summary Period and Phase Angle from ACF and CCF before and after LDI")

TwoWayTukey_Period <- aov(PeriodACF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("T0","T1","T2","T3","T4","T5","T6"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Period[c(1:7,23,24,26,28,30,32,34,37,39,41,43,45,47,48,69,86,99,108,113), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for period before and after LDI")


TwoWayTukey_Phase <- aov(PhaseCCF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("T0","T1","T2","T3","T4","T5","T6"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Phase[c(1:7,23,24,26,28,30,32,34,37,39,41,43,45,47,48,69,86,99,108,113), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for phase before and after LDI")



ACF_ALL$portion <- factor(ACF_ALL$portion, levels = c("T0","T1","T2","T3","T4","T5","T6"))

bxp_CBTperiods <- ggplot(
    ACF_ALL %>% filter(portion %in% c("T0","T1","T2","T3","T4","T5","T6")), 
    aes(x = group,
        y = PeriodACF,
        color = portion))

bxp_CBTperiods + geom_boxplot() +
  scale_color_manual(values = c("T0" = "black",
                                "T1" = "red",
                                "T2" = "orange",
                                "T3" = "yellow",
                                "T4" = "lightgreen",
                                "T5" = "darkgreen",
                                "T6" = "blue")) +
    labs(title = "Periods before and after LDI",
         y = "Period (hrs)") +
  ylim(23,25.5)+
      theme_classic()


bxp_CBTperiodsB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("T0","T1","T2","T3","T4","T5","T6")), 
    aes(x = portion,
        y = PeriodACF,
        color = group))

bxp_CBTperiodsB + geom_boxplot() +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red")) +
    labs(title = "Periods before and after LDI",
         y = "Period (hrs)") +
      theme_classic()


# Analysis of Phase from CCF


bxp_CBT_phase <- ggplot(
    ACF_ALL %>% filter(portion %in% c("T0","T1","T2","T3","T4","T5","T6")), 
    aes(x = group,
        y = PhaseCCF,
        color = portion))

bxp_CBT_phase + geom_boxplot() +
  scale_color_manual(values = c("T0" = "black",
                                "T1" = "red",
                                "T2" = "orange",
                                "T3" = "yellow",
                                "T4" = "lightgreen",
                                "T5" = "darkgreen",
                                "T6" = "blue")) +
    labs(title = "Phase before and after LDI",
         y = "Phase angle (hrs)") +
      theme_classic()

bxp_CBT_phaseB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("T0","T1","T2","T3","T4","T5","T6")), 
    aes(x = portion,
        y = PhaseCCF,
        color = group))

bxp_CBT_phaseB + geom_boxplot() +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red")) +
    labs(title = "Phase before and after LDI",
         y = "Phase angle (hrs)") +
      theme_classic()

write_excel_csv(ACF_ALL, "T0thruT6_CBTphases.xls")

```


``` {r Plot CBTavg with shading to indicate lights on and off, eval=TRUE, echo=FALSE, include=TRUE}

DatI <- SeriesData %>% filter(CorrectDate > "2024-02-03" & 
                                             CorrectDate < "2024-03-03") %>% select(3,4,5,8,9,10)

DatIrounded <- DatI
DatIrounded$datetime_corr <- round_date(DatIrounded$datetime_corr, "10 minutes")

DatIgrouped <- DatIrounded %>% group_by(Group,datetime_corr)
DatIsumm <- summarise(DatIgrouped,
                      CBTavg = mean(CBTtest),
                      sd = sd(CBTtest),
                      Light = Light)


Dat <- DatIsumm

LDbkgrd <- ggplot() + 
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-04 00:00:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-04 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-04 00:00:00 UTC"),
                 xmax=as.POSIXct("2024-02-04 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
              scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-04 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-04 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-04 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-04 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-04 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-05 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-04 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-05 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-05 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-05 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
# On February 10, we did the LDI at 10:00 am. So, the first unexpected schedule is that lights went fron ON to OFF at 10am instead of at 3pm. So there is a shorter than usual lights ON follwed by a shorter than usual lights OFF, then they return to 12-hour cycles but with reversed phase.

  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-10 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 09:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-10 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 09:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-10 10:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-10 10:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-10 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-11 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-10 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-11 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-11 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-11 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-11 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-11 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-11 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-12 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-11 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-12 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-12 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-12 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-12 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-12 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-12 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-13 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-12 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-13 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-13 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-13 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-13 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-13 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-13 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-14 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-13 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-14 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-14 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-14 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-14 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-14 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-14 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-15 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-14 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-15 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-15 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-15 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-15 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-15 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-15 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-16 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-15 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-16 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-16 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-16 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-16 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-16 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-16 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-17 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-16 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-17 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-17 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-17 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-17 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-17 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-17 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-18 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-17 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-18 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-18 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-18 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-18 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-18 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-18 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-18 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-18 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-18 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-18 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-19 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-18 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-19 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-19 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-19 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-19 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-19 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-19 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-20 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-19 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-20 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-20 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-20 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-20 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-20 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-20 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-21 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-20 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-21 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-21 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-21 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-21 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-21 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-21 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-22 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-21 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-22 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-22 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-22 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-22 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-22 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-22 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-23 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-22 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-23 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-23 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-23 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-23 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-23 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-23 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-24 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-23 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-24 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-24 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-24 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-24 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-24 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-24 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-25 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-24 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-25 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-25 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-25 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-25 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-25 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-25 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-26 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-25 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-26 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-26 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-26 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-03 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-03 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light))))
  
LDbkgrd +  geom_line(data = Dat,
            aes(x = datetime_corr, y = CBTavg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('Temperature (C)') +
  labs(title = paste("Average CBT for each group"),
       subtitle = "February 4 - March 3")
ggsave("FullCombinedAverages.pdf")

# Show a couple of examples, one from each group:

LDbkgrd + geom_line(data = DatIrounded %>% filter(mouse == 1),
            aes(x = datetime_corr, y = CBTtest, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('Temperature (C)') +
  labs(title = paste("Indiviatual mouse CBT"),
       subtitle = "February 4 - March 3")
ggsave("FullCombinedMouse1.pdf")

LDbkgrd + geom_line(data = DatIrounded %>% filter(mouse == 3),
            aes(x = datetime_corr, y = CBTtest, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('Temperature (C)') +
  labs(title = paste("Indiviatual mouse CBT"),
       subtitle = "February 4 - March 3")
ggsave("FullCombinedMouse3.pdf")

LDbkgrd + geom_line(data = DatIrounded %>% filter(mouse == 5),
            aes(x = datetime_corr, y = CBTtest, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('Temperature (C)') +
  labs(title = paste("Indiviatual mouse CBT"),
       subtitle = "February 4 - March 3")
ggsave("FullCombinedMouse5.pdf")

LDbkgrd + geom_line(data = DatIrounded %>% filter(mouse == 10),
            aes(x = datetime_corr, y = CBTtest, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('Temperature (C)') +
  labs(title = paste("Indiviatual mouse CBT"),
       subtitle = "February 4 - March 3")
ggsave("FullCombinedMouse10.pdf")

LDbkgrd + geom_line(data = DatIrounded %>% filter(mouse == 12),
            aes(x = datetime_corr, y = CBTtest, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('Temperature (C)') +
  labs(title = paste("Indiviatual mouse CBT"),
       subtitle = "February 4 - March 3")
ggsave("FullCombinedMouse12.pdf")

LDbkgrd + geom_line(data = DatIrounded %>% filter(mouse == 14),
            aes(x = datetime_corr, y = CBTtest, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('Temperature (C)') +
  labs(title = paste("Indiviatual mouse CBT"),
       subtitle = "February 4 - March 3")
ggsave("FullCombinedMouse14.pdf")

```





```{r plot CBT in CLAMS1 and CLAMS2 timeframes to match CLAMS data}

DatI <- SeriesData %>% filter(CorrectDate > "2024-02-04" & 
                                             CorrectDate < "2024-02-10")

DatIrounded <- DatI
DatIrounded$datetime_corr <- round_date(DatIrounded$datetime_corr, "10 minutes")

DatIgrouped <- DatIrounded %>% group_by(Group,datetime_corr)
DatIsumm <- summarise(DatIgrouped,
                      CBTavg = mean(CBTtest),
                      sd = sd(CBTtest),
                      Light = Light)

Dat <- DatIsumm

ggplot() +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-04 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-05 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-04 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-05 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-05 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-05 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_line(data = Dat,
            aes(x = datetime_corr, y = CBTavg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('CBT') +
  labs(title = paste("Average CBT for each group"),
       subtitle = "CLAMS1")



DatII <- SeriesData %>% filter(CorrectDate > "2024-02-26" & 
                                             CorrectDate < "2024-03-03")

DatIIrounded <- DatII
DatIIrounded$datetime_corr <- round_date(DatIIrounded$datetime_corr, "10 minutes")

DatIIgrouped <- DatIIrounded %>% group_by(Group,datetime_corr)
DatIIsumm <- summarise(DatIIgrouped,
                      CBTavg = mean(CBTtest),
                      sd = sd(CBTtest),
                      Light = Light)

Dat <- DatIIsumm

ggplot() +
      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 02:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-03 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-03 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 14:55:00 UTC"),
                 ymin=34,
                 ymax=39,
                 fill=factor(Light)))) +  
  geom_line(data = Dat,
            aes(x = datetime_corr, y = CBTavg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('CBT') +
  labs(title = paste("Average CBT for each group"),
       subtitle = "CLAMS2")



```

```{r generate phase boxplot for CLAMS1 and CLAMS2 dates, fig.height=2.5, fig.width=3.5}

# CTRL mice CLAMS1 (DatI) and CLAMS2 (DatII)

Pill <- 9

mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "CTRL"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "CTRL"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib,CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- ACFtib


Pill <- 10
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "CTRL"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "CTRL"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)



Pill <- 11
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "CTRL"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "CTRL"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)



Pill <- 12
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "CTRL"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "CTRL"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)



Pill <- 13
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "CTRL"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "CTRL"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)



Pill <- 14
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "CTRL"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "CTRL"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)



Pill <- 15
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "CTRL"
CLAMSIacftib$portion <- "CLAMSI"

# pill 15 ran out of battery before CLAMSII.

#mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
 # select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
#mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
 #                        mouseCLAMSII$CBT[2],
  #                       mouseCLAMSII$CBT[1])
#mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
#test <- mouseCLAMSII$CBT
#ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
#pCLAMSII <- plot(ts_mouse)
#testL <- mouseCLAMSII$Lightseries
#ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
#CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
#CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
#colnames(CLAMSIIacftib) <- c("hours","ACF")
#CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
#MAX <- max(CLAMSIIacftib$ACF)
#PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
#CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
#CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
#CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
#colnames(CLAMSIIccftib) <- c("hours","ACF")
#CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
#MAX <- max(CLAMSIIccftib$ACF)
#PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
#CLAMSIIacftib$PhaseCCF <- PhaseCCF
#CLAMSIIacftib$group <- "CTRL"
#CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)



# RW series


Pill <- 1

mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "RW"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "RW"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib,CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombRW <- ACFtib


Pill <- 3
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "RW"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "RW"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)



Pill <- 4
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "RW"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "RW"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)



Pill <- 5
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "RW"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "RW"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)



Pill <- 6
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "RW"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "RW"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)



Pill <- 7
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "RW"
CLAMSIacftib$portion <- "CLAMSI"


#mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
 # select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
#mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
 #                        mouseCLAMSII$CBT[2],
  #                       mouseCLAMSII$CBT[1])
#mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
#test <- mouseCLAMSII$CBT
#ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
#pCLAMSII <- plot(ts_mouse)
#testL <- mouseCLAMSII$Lightseries
#ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
#CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
#CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
#colnames(CLAMSIIacftib) <- c("hours","ACF")
#CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
#MAX <- max(CLAMSIIacftib$ACF)
#PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
#CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
#CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
#CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
#colnames(CLAMSIIccftib) <- c("hours","ACF")
#CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
#MAX <- max(CLAMSIIccftib$ACF)
#PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
#CLAMSIIacftib$PhaseCCF <- PhaseCCF
#CLAMSIIacftib$group <- "RW"
#CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)



Pill <- 8
mouseCLAMSI <- DatI %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSI$CBT[1] = ifelse(is.na(mouseCLAMSI$CBT[1]),
                         mouseCLAMSI$CBT[2],
                         mouseCLAMSI$CBT[1])
mouseCLAMSI$CBT <- na.approx(mouseCLAMSI$CBT)
test <- mouseCLAMSI$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSI <- plot(ts_mouse)
testL <- mouseCLAMSI$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIacftib <- as_tibble(cbind(CLAMSIacf$lag,CLAMSIacf$acf))
colnames(CLAMSIacftib) <- c("hours","ACF")
CLAMSIacftib <- CLAMSIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIacftib$ACF)
PeriodACF <- CLAMSIacftib$hours[CLAMSIacftib$ACF == MAX]
CLAMSIacftib <- CLAMSIacftib %>% filter(hours == PeriodACF)
CLAMSIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIccftib <- as_tibble(cbind(CLAMSIccf$lag,CLAMSIccf$acf))
colnames(CLAMSIccftib) <- c("hours","ACF")
CLAMSIccftib <- CLAMSIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIccftib$ACF)
PhaseCCF <- CLAMSIccftib$hours[CLAMSIccftib$ACF == MAX]
CLAMSIacftib$PhaseCCF <- PhaseCCF
CLAMSIacftib$group <- "RW"
CLAMSIacftib$portion <- "CLAMSI"


mouseCLAMSII <- DatII %>% filter(mouse == Pill) %>% 
  select(datetime_corr, CBT, Light) %>% na.trim() %>% mutate(Lightseries = ifelse(Light == "ON", 1, 0))
mouseCLAMSII$CBT[1] = ifelse(is.na(mouseCLAMSII$CBT[1]),
                         mouseCLAMSII$CBT[2],
                         mouseCLAMSII$CBT[1])
mouseCLAMSII$CBT <- na.approx(mouseCLAMSII$CBT)
test <- mouseCLAMSII$CBT
ts_mouse <- ts(test, start = 1, frequency = 12, deltat = 1)
pCLAMSII <- plot(ts_mouse)
testL <- mouseCLAMSII$Lightseries
ts_light <- ts(testL, start = 1, frequency = 12, deltat = 1)
CLAMSIIacf <- acf(ts_mouse, lag.max = 30*12, plot = FALSE)
CLAMSIIacftib <- as_tibble(cbind(CLAMSIIacf$lag,CLAMSIIacf$acf))
colnames(CLAMSIIacftib) <- c("hours","ACF")
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours > 18 & hours < 30)
MAX <- max(CLAMSIIacftib$ACF)
PeriodACF <- CLAMSIIacftib$hours[CLAMSIIacftib$ACF == MAX]
CLAMSIIacftib <- CLAMSIIacftib %>% filter(hours == PeriodACF)
CLAMSIIccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
CLAMSIIccftib <- as_tibble(cbind(CLAMSIIccf$lag,CLAMSIIccf$acf))
colnames(CLAMSIIccftib) <- c("hours","ACF")
CLAMSIIccftib <- CLAMSIIccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(CLAMSIIccftib$ACF)
PhaseCCF <- CLAMSIIccftib$hours[CLAMSIIccftib$ACF == MAX]
CLAMSIIacftib$PhaseCCF <- PhaseCCF
CLAMSIIacftib$group <- "RW"
CLAMSIIacftib$portion <- "CLAMSII"


ACFtib <- rbind(CLAMSIacftib, CLAMSIIacftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


ACF_ALL <- rbind(ACFcombCTRL, ACFcombRW)

TwoWayTukeyC1C2 <- aov(PhaseCCF ~ portion*group, data = ACF_ALL) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukeyC1C2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for CBT phase in CLAMS1 and CLAMS2")


bxp_CBT_phase <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMSI", "CLAMSII")), 
    aes(x = group,
        y = PhaseCCF,
        color = portion))

bxp_CBT_phase + geom_boxplot() +
  scale_color_manual(values = c("CLAMSI" = "gray",
                                "CLAMSII" = "blue")) +
  ylim(8,16) +
    labs(title = "Phase before and after LDI",
         y = "Phase (ZT)") +
      theme_classic()

```

```{r reshape to calculate phase shift for each animal}
write_excel_csv(ACF_ALL, "ACF_ALL.xls")

library(reshape2) 

#ACF_ALL$mouse <- as.character(ACF_ALL$mouse)
#cast_data = cast(ACF_ALL, mouse~portion, mean)

```

```{r boxplots for light and dark CBTs in CLAMS1 and CLAMS2, fig.height=2.5, fig.width=3.5}

DatCLAMS1 <- DatI %>% select(mouse, Group, Light, CBTtest)
DatCLAMS1$portion <- "CLAMS1"
DatCLAMS2 <- DatII %>% select(mouse, Group, Light, CBTtest)
DatCLAMS2$portion <- "CLAMS2"

DatC1andC2 <- rbind(DatCLAMS1, DatCLAMS2) %>% group_by(mouse, Group, Light, portion)

SummC1andC2 <- summarise(DatC1andC2,
                         meanCBT = mean(CBTtest),
                         Group = Group,
                         Light = Light,
                         portion = portion)

TwoWayTukey_C1C2_CBT_CTRL <- aov(meanCBT ~ Light*portion, data = SummC1andC2 %>% filter(Group == "CTRL")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_CBT_CTRL[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for CTRL CLAMS1 vs CLAMS2")

TwoWayTukey_C1C2_CBT_RW <- aov(meanCBT ~ Light*portion, data = SummC1andC2 %>% filter(Group == "RW")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_CBT_RW[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for RW CLAMS1 vs CLAMS2")

SummC1andC2$Group <- factor(SummC1andC2$Group, levels = c("CTRL","RW"))
SummC1andC2$Light <- factor(SummC1andC2$Light, levels = c("ON","OFF"))

bxp <- ggplot(
    SummC1andC2 %>% filter(meanCBT > 32),
    aes(x = Group,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "CBT (deg C)") +
  ylim(34,38) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummC1andC2 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = Group))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "CBT (deg C)") +
  ylim(34,38) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()








bxp <- ggplot(
    SummC1andC2 %>% filter(meanCBT > 32),
    aes(x = portion,
        y = meanCBT,
        color = Light))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("ON" = "gray",
                                "OFF" = "black"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "CBT (deg C)") +
  ylim(34,38) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxp <- ggplot(
    SummC1andC2 %>% filter(meanCBT > 32),
    aes(x = Light,
        y = meanCBT,
        color = portion))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "CBT (deg C)") +
  ylim(34,38) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()
```
```{r export csv files in AWD format for ClockLab}

# Generate the required Header including the date and time at which series start

for (i in c(1,3:15)) {
  Pill <- i
AWDdata <- SeriesData %>% filter(mouse == Pill) %>% select(CBTtest) %>% rename("test" = "CBTtest")
header <- c("05-feb-2024","00:00",20,0,Pill,"M")
header <- data.frame(header) %>% rename("test" = "header")
AWDdata <- rbind(header,AWDdata)
write_csv(AWDdata,paste0("Mouse",Pill,"Series.AWD"))
}

```

