---
title: "CLAMS Analysis Before and After Light-Dark Inversion"
output:
  word_document: default
  html_document: default
  pdf_document: default
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## How does a single light-dark inversion affect metabolism in mice with or without access to a running wheel?

In an earlier experiment, Amanda Roberts collected data that seemed to suggest a very slow adjustment of circadian entrainment after a light-dark inversion in contrast to prior literature and our own experience measuring re-entrainment in mice housed in running wheel cages. So, Andrea Ciorciari set up an experiment to measure re-entrainment using core body temperature and metabolic cage data in mice that were given access to a running wheel or housed in standard conditions.

Emanuel Irizarry implanted Anipill capsules (BodyCAP, Inc.) to continuously record core body temperature in male c57BL/6J mice. Surgeries were performed in January 2024 and mice recovered for ____ before being placed in light-controlled conditions in February 2024. On 2/12/24, the lighting schedule was changed from lights ON at 3am and OFF at 3pm, to lights ON at 3pm and lights OFF at 3am (a 12-hour phase shift, a.k.a. light-dark inversion). 

The first CLAMS test was done from 2/6/24 through 2/10/24.
The second CLAMS test was done from 2/27/24 through 3/3/24.

```{r load packages, echo=FALSE, include=FALSE}
Sys.setenv(TZ = "UTC")

library(gsignal)
library(zoo)
library(tidyverse)
library(dplyr)
library(lubridate)
library(ggplot2)
library(rstatix)
library(ggpubr)
library(knitr)

```

For the purposes of comparing data collected during light and dark phases, we define DAY as ZT2-ZT10 and NIGHT as ZT14-ZT22.  (And corresponds to 5am-1pm for DAY and 5pm to 1am for NIGHT).

```{r read in CLAMS1 data, include=FALSE, echo=FALSE}
#CLAMS data were provided in an Excel workbook from Amanda Roberts. Each mouse was in a separate sheet. Those were exported as .csv files

coltypes <- "ccddddddddd"
CLAMS1_1451 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1451.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1451$mouse <- 1451
CLAMS1_1451$pill <- 12
CLAMS1_1451$Group <- "RW"
CLAMS1_1451$CorrectDate <- date(mdy_hm(CLAMS1_1451$`DATE/TIME`))
CLAMS1_1451$TimeOfDay <- hour(mdy_hm(CLAMS1_1451$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1451$`DATE/TIME`))/60

CLAMS1_1468 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1468.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1468$mouse <- 1468
CLAMS1_1468$pill <- 11
CLAMS1_1468$Group <- "RW"
CLAMS1_1468$CorrectDate <- date(mdy_hm(CLAMS1_1468$`DATE/TIME`))
CLAMS1_1468$TimeOfDay <- hour(mdy_hm(CLAMS1_1468$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1468$`DATE/TIME`))/60

CLAMS1_1469 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1469.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1469$mouse <- 1469
CLAMS1_1469$pill <- 9
CLAMS1_1469$Group <- "RW"
CLAMS1_1469$CorrectDate <- date(mdy_hm(CLAMS1_1469$`DATE/TIME`))
CLAMS1_1469$TimeOfDay <- hour(mdy_hm(CLAMS1_1469$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1469$`DATE/TIME`))/60

CLAMS1_1470 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1470.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1470$mouse <- 1470
CLAMS1_1470$pill <- 10
CLAMS1_1470$Group <- "RW"
CLAMS1_1470$CorrectDate <- date(mdy_hm(CLAMS1_1470$`DATE/TIME`))
CLAMS1_1470$TimeOfDay <- hour(mdy_hm(CLAMS1_1470$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1470$`DATE/TIME`))/60

CLAMS1_1482 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1482.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1482$mouse <- 1482
CLAMS1_1482$pill <- 7
CLAMS1_1482$Group <- "CTRL"
CLAMS1_1482$CorrectDate <- date(mdy_hm(CLAMS1_1482$`DATE/TIME`))
CLAMS1_1482$TimeOfDay <- hour(mdy_hm(CLAMS1_1482$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1482$`DATE/TIME`))/60

CLAMS1_1523 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1523.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1523$mouse <- 1523
CLAMS1_1523$pill <- 8
CLAMS1_1523$Group <- "CTRL"
CLAMS1_1523$CorrectDate <- date(mdy_hm(CLAMS1_1523$`DATE/TIME`))
CLAMS1_1523$TimeOfDay <- hour(mdy_hm(CLAMS1_1523$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1523$`DATE/TIME`))/60

CLAMS1_1541 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1541.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1541$mouse <- 1541
CLAMS1_1541$pill <- 1
CLAMS1_1541$Group <- "CTRL"
CLAMS1_1541$CorrectDate <- date(mdy_hm(CLAMS1_1541$`DATE/TIME`))
CLAMS1_1541$TimeOfDay <- hour(mdy_hm(CLAMS1_1541$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1541$`DATE/TIME`))/60

#CLAMS1_1548 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1548.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
#CLAMS1_1548$mouse <- 1548
#CLAMS1_1548$pill <- 4
#CLAMS1_1548$Group <- "CTRL"
#CLAMS1_1548$CorrectDate <- date(mdy_hm(CLAMS1_1548$`DATE/TIME`))
#CLAMS1_1548$TimeOfDay <- hour(mdy_hm(CLAMS1_1548$`DATE/TIME`)) +
 #          minute(mdy_hm(CLAMS1_1548$`DATE/TIME`))/60

CLAMS1_1549 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1549.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1549$mouse <- 1549
CLAMS1_1549$pill <- 3
CLAMS1_1549$Group <- "CTRL"
CLAMS1_1549$CorrectDate <- date(mdy_hm(CLAMS1_1549$`DATE/TIME`))
CLAMS1_1549$TimeOfDay <- hour(mdy_hm(CLAMS1_1549$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1549$`DATE/TIME`))/60

CLAMS1_1550 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1550.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1550$mouse <- 1550
CLAMS1_1550$pill <- 2
CLAMS1_1550$Group <- "CTRL"
CLAMS1_1550$CorrectDate <- date(mdy_hm(CLAMS1_1550$`DATE/TIME`))
CLAMS1_1550$TimeOfDay <- hour(mdy_hm(CLAMS1_1550$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1550$`DATE/TIME`))/60

CLAMS1_1543 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1543.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1543$mouse <- 1543
CLAMS1_1543$pill <- 5
CLAMS1_1543$Group <- "CTRL"
CLAMS1_1543$CorrectDate <- date(mdy_hm(CLAMS1_1543$`DATE/TIME`))
CLAMS1_1543$TimeOfDay <- hour(mdy_hm(CLAMS1_1543$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1543$`DATE/TIME`))/60

CLAMS1_1546 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1546.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1546$mouse <- 1546
CLAMS1_1546$pill <- 6
CLAMS1_1546$Group <- "CTRL"
CLAMS1_1546$CorrectDate <- date(mdy_hm(CLAMS1_1546$`DATE/TIME`))
CLAMS1_1546$TimeOfDay <- hour(mdy_hm(CLAMS1_1546$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1546$`DATE/TIME`))/60

CLAMS1_1589 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1589.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1589$mouse <- 1589
CLAMS1_1589$pill <- 13
CLAMS1_1589$Group <- "RW"
CLAMS1_1589$CorrectDate <- date(mdy_hm(CLAMS1_1589$`DATE/TIME`))
CLAMS1_1589$TimeOfDay <- hour(mdy_hm(CLAMS1_1589$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1589$`DATE/TIME`))/60

CLAMS1_1585 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1585.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1585$mouse <- 1585
CLAMS1_1585$pill <- 14
CLAMS1_1585$Group <- "RW"
CLAMS1_1585$CorrectDate <- date(mdy_hm(CLAMS1_1585$`DATE/TIME`))
CLAMS1_1585$TimeOfDay <- hour(mdy_hm(CLAMS1_1585$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1585$`DATE/TIME`))/60

CLAMS1_1453 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest1/1453.csv", skip=1, col_types = coltypes) %>% select(1,2,4:11) %>% drop_na()
CLAMS1_1453$mouse <- 1453
CLAMS1_1453$pill <- 15
CLAMS1_1453$Group <- "RW"
CLAMS1_1453$CorrectDate <- date(mdy_hm(CLAMS1_1453$`DATE/TIME`))
CLAMS1_1453$TimeOfDay <- hour(mdy_hm(CLAMS1_1453$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS1_1453$`DATE/TIME`))/60


DatCombCLAMS1 <- rbind(CLAMS1_1451,
                       CLAMS1_1453,
                       CLAMS1_1468,
                       CLAMS1_1469,
                       CLAMS1_1470,
                       CLAMS1_1482,
                       CLAMS1_1523,
                       CLAMS1_1541,
                       CLAMS1_1543,
                       CLAMS1_1546,
                       #CLAMS1_1548,
                       CLAMS1_1549,
                       CLAMS1_1550,
                       CLAMS1_1585,
                       CLAMS1_1589)


```

```{r read in CLAMS2 data, include=FALSE, echo=FALSE}
#CLAMS data were provided in an Excel workbook from Amanda Roberts. Each mouse was in a separate sheet. Those were exported as .csv files

coltypes <- "ccdddddddd"
CLAMS2_1451 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1451.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1451$mouse <- 1451
CLAMS2_1451$pill <- 12
CLAMS2_1451$Group <- "RW"
CLAMS2_1451$CorrectDate <- date(mdy_hm(CLAMS2_1451$`DATE/TIME`))
CLAMS2_1451$TimeOfDay <- hour(mdy_hm(CLAMS2_1451$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1451$`DATE/TIME`))/60

CLAMS2_1468 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1468.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1468$mouse <- 1468
CLAMS2_1468$pill <- 11
CLAMS2_1468$Group <- "RW"
CLAMS2_1468$CorrectDate <- date(mdy_hm(CLAMS2_1468$`DATE/TIME`))
CLAMS2_1468$TimeOfDay <- hour(mdy_hm(CLAMS2_1468$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1468$`DATE/TIME`))/60

CLAMS2_1469 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1469.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1469$mouse <- 1469
CLAMS2_1469$pill <- 9
CLAMS2_1469$Group <- "RW"
CLAMS2_1469$CorrectDate <- date(mdy_hm(CLAMS2_1469$`DATE/TIME`))
CLAMS2_1469$TimeOfDay <- hour(mdy_hm(CLAMS2_1469$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1469$`DATE/TIME`))/60

CLAMS2_1470 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1470.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1470$mouse <- 1470
CLAMS2_1470$pill <- 10
CLAMS2_1470$Group <- "RW"
CLAMS2_1470$CorrectDate <- date(mdy_hm(CLAMS2_1470$`DATE/TIME`))
CLAMS2_1470$TimeOfDay <- hour(mdy_hm(CLAMS2_1470$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1470$`DATE/TIME`))/60

CLAMS2_1482 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1482.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1482$mouse <- 1482
CLAMS2_1482$pill <- 7
CLAMS2_1482$Group <- "CTRL"
CLAMS2_1482$CorrectDate <- date(mdy_hm(CLAMS2_1482$`DATE/TIME`))
CLAMS2_1482$TimeOfDay <- hour(mdy_hm(CLAMS2_1482$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1482$`DATE/TIME`))/60

CLAMS2_1523 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1523.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1523$mouse <- 1523
CLAMS2_1523$pill <- 8
CLAMS2_1523$Group <- "CTRL"
CLAMS2_1523$CorrectDate <- date(mdy_hm(CLAMS2_1523$`DATE/TIME`))
CLAMS2_1523$TimeOfDay <- hour(mdy_hm(CLAMS2_1523$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1523$`DATE/TIME`))/60

CLAMS2_1541 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1541.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1541$mouse <- 1541
CLAMS2_1541$pill <- 1
CLAMS2_1541$Group <- "CTRL"
CLAMS2_1541$CorrectDate <- date(mdy_hm(CLAMS2_1541$`DATE/TIME`))
CLAMS2_1541$TimeOfDay <- hour(mdy_hm(CLAMS2_1541$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1541$`DATE/TIME`))/60

#CLAMS2_1548 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1548.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
#CLAMS2_1548$mouse <- 1548
#CLAMS2_1548$pill <- 4
#CLAMS2_1548$Group <- "CTRL"
#CLAMS2_1548$CorrectDate <- date(mdy_hm(CLAMS2_1548$`DATE/TIME`))
#CLAMS2_1548$TimeOfDay <- hour(mdy_hm(CLAMS2_1548$`DATE/TIME`)) +
#           minute(mdy_hm(CLAMS2_1548$`DATE/TIME`))/60

CLAMS2_1549 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1549.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1549$mouse <- 1549
CLAMS2_1549$pill <- 3
CLAMS2_1549$Group <- "CTRL"
CLAMS2_1549$CorrectDate <- date(mdy_hm(CLAMS2_1549$`DATE/TIME`))
CLAMS2_1549$TimeOfDay <- hour(mdy_hm(CLAMS2_1549$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1549$`DATE/TIME`))/60

CLAMS2_1550 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1550.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1550$mouse <- 1550
CLAMS2_1550$pill <- 2
CLAMS2_1550$Group <- "CTRL"
CLAMS2_1550$CorrectDate <- date(mdy_hm(CLAMS2_1550$`DATE/TIME`))
CLAMS2_1550$TimeOfDay <- hour(mdy_hm(CLAMS2_1550$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1550$`DATE/TIME`))/60

CLAMS2_1543 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1543.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1543$mouse <- 1543
CLAMS2_1543$pill <- 5
CLAMS2_1543$Group <- "CTRL"
CLAMS2_1543$CorrectDate <- date(mdy_hm(CLAMS2_1543$`DATE/TIME`))
CLAMS2_1543$TimeOfDay <- hour(mdy_hm(CLAMS2_1543$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1543$`DATE/TIME`))/60

CLAMS2_1546 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1546.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1546$mouse <- 1546
CLAMS2_1546$pill <- 6
CLAMS2_1546$Group <- "CTRL"
CLAMS2_1546$CorrectDate <- date(mdy_hm(CLAMS2_1546$`DATE/TIME`))
CLAMS2_1546$TimeOfDay <- hour(mdy_hm(CLAMS2_1546$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1546$`DATE/TIME`))/60

CLAMS2_1589 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1589.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1589$mouse <- 1589
CLAMS2_1589$pill <- 13
CLAMS2_1589$Group <- "RW"
CLAMS2_1589$CorrectDate <- date(mdy_hm(CLAMS2_1589$`DATE/TIME`))
CLAMS2_1589$TimeOfDay <- hour(mdy_hm(CLAMS2_1589$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1589$`DATE/TIME`))/60

CLAMS2_1585 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1585.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1585$mouse <- 1585
CLAMS2_1585$pill <- 14
CLAMS2_1585$Group <- "RW"
CLAMS2_1585$CorrectDate <- date(mdy_hm(CLAMS2_1585$`DATE/TIME`))
CLAMS2_1585$TimeOfDay <- hour(mdy_hm(CLAMS2_1585$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1585$`DATE/TIME`))/60

CLAMS2_1453 <- read_delim("DATASP/Side_Project/CLAMS_SP/CLAMStest2/1453.csv", skip=1, col_types = coltypes) %>% select(1:10) %>% drop_na()
CLAMS2_1453$mouse <- 1453
CLAMS2_1453$pill <- 15
CLAMS2_1453$Group <- "RW"
CLAMS2_1453$CorrectDate <- date(mdy_hm(CLAMS2_1453$`DATE/TIME`))
CLAMS2_1453$TimeOfDay <- hour(mdy_hm(CLAMS2_1453$`DATE/TIME`)) +
           minute(mdy_hm(CLAMS2_1453$`DATE/TIME`))/60


DatCombCLAMS2 <- rbind(CLAMS2_1451,
                       CLAMS2_1453,
                       CLAMS2_1468,
                       CLAMS2_1469,
                       CLAMS2_1470,
                       CLAMS2_1482,
                       CLAMS2_1523,
                       CLAMS2_1541,
                       CLAMS2_1543,
                       CLAMS2_1546,
                       #CLAMS2_1548,
                       CLAMS2_1549,
                       CLAMS2_1550,
                       CLAMS2_1585,
                       CLAMS2_1589)

```

```{r create master CLAMS dataframes}

CLAMS_Comb <- rbind(DatCombCLAMS1,DatCombCLAMS2) %>%
  mutate(datetime_corr = as.POSIXct(mdy_hm(`DATE/TIME`))) %>%
  mutate(Lightseries = ifelse(str_detect(LIGHTING, "ON"), 1, 0))

CLAMS_Comb <- CLAMS_Comb %>%
  mutate(ExpPhase = ifelse(datetime_corr < dmy("12-02-2024"), "CLAMS1", "CLAMS2"))


# Test removing mouse #1589 and #1549
#CLAMS_Comb <- CLAMS_Comb %>% filter(!mouse == 1589 & !mouse == 1549)
#CLAMS_Comb_DayNight <- CLAMS_Comb_DayNight %>% filter(!mouse == 1589 & !mouse == 1549)

# Test calculating RER from VO2 and VCO2 instead of using numbers from Amanda

CLAMS_Comb <- CLAMS_Comb %>% mutate(ZTgroup = ifelse(Lightseries == 1,
                                                     "LIGHT", "DARK"))

```


```{r statistics for CLAMS and grouped boxplots, fig.height=2.5, fig.width=3.5}

SummCLAMSComb <- summarise(CLAMS_Comb %>%
                    group_by(ExpPhase, ZTgroup, Group) %>%
                    drop_na(),
                    VO2 = mean(VO2),
                    VCO2 = mean(VCO2),
                    RER = mean(RER),
                    FEED = mean(FEED1),
                    DRINK = mean(DRINK1),
                    PA = mean(XTOT))

data <- SummCLAMSComb
knitr::kable(data,
caption = "Summary of group averages in CLAMS data PRE and POST LDI")


AOV_Tukey_VO2 <- aov(VO2 ~ ExpPhase*ZTgroup*Group, 
                      data = CLAMS_Comb) %>% tukey_hsd() %>%
  add_significance()



CLAMS_Ranges <- summarise(CLAMS_Comb %>%
                    group_by(ExpPhase, Group, pill) %>%
                    drop_na(),
                    VO2max = max(VO2),
                    VO2min = min(VO2),
                    VCO2max = max(VCO2),
                    VCO2min = min(VCO2),
                    RERmax = max(RER),
                    RERmin = min(RER),
                    FEEDmax = max(FEED1),
                    FEEDmin = min(FEED1),
                    DRINKmax = max(DRINK1),
                    DRINKmin = min(DRINK1),
                    PAmax = max(XTOT),
                    PAmin = min(XTOT))

CLAMS_AMPs <- CLAMS_Ranges
CLAMS_AMPs <- CLAMS_AMPs %>% mutate(
  VO2amp = (VO2max - VO2min)/((VO2max + VO2min)/2),
  VCO2amp = (VCO2max - VCO2min)/((VCO2max + VCO2min)/2),
  RERamp = (RERmax - RERmin)/((RERmax + RERmin)/2),
  FEEDamp = (FEEDmax - FEEDmin)/((FEEDmax + FEEDmin)/2),
  DRINKamp = (DRINKmax - DRINKmin)/((DRINKmax + DRINKmin)/2),
  PAamp = (PAmax - PAmin)/((PAmax + PAmin)/2)
)

AOV_CLAMS_VO2amp <- aov(VO2amp ~ ExpPhase*Group, data = CLAMS_AMPs) %>% tukey_hsd() %>%
  add_significance()
AOV_CLAMS_VCO2amp <- aov(VCO2amp ~ ExpPhase*Group, data = CLAMS_AMPs) %>% tukey_hsd() %>%
  add_significance()
AOV_CLAMS_RERamp <- aov(RERamp ~ ExpPhase*Group, data = CLAMS_AMPs) %>% tukey_hsd() %>%
  add_significance()
AOV_CLAMS_VO2amp <- aov(VO2amp ~ ExpPhase*Group, data = CLAMS_AMPs) %>% tukey_hsd() %>%
  add_significance()
AOV_CLAMS_VO2amp <- aov(VO2amp ~ ExpPhase*Group, data = CLAMS_AMPs) %>% tukey_hsd() %>%
  add_significance()


Summ_CLAMS_AMPs <- summarise(CLAMS_AMPs %>%
                               group_by(ExpPhase,Group),
                             VO2amp = mean(VO2amp),
                             VCO2amp = mean(VCO2amp),
                             RERamp = mean(RERamp),
                             FEEDamp = mean(FEEDamp),
                             DRINKamp = mean(DRINKamp),
                             PAamp = mean(PAamp)
                             )

SummCLAMS_Ranges <- summarise(CLAMS_Ranges %>%
                    group_by(ExpPhase, Group) %>%
                    drop_na(),
                    VO2max = mean(VO2max),
                    VO2min = mean(VO2min),
                    VCO2max = mean(VCO2max),
                    VCO2min = mean(VCO2min),
                    RERmax = mean(RERmax),
                    RERmin = mean(RERmin),
                    FEEDmax = mean(FEEDmax),
                    FEEDmin = mean(FEEDmin),
                    DRINKmax = mean(DRINKmax),
                    DRINKmin = mean(DRINKmin),
                    PAmax = mean(PAmax),
                    PAmin = mean(PAmin))

data <- SummCLAMS_Ranges
knitr::kable(data,
caption = "Summary of ranges in CLAMS data PRE and POST LDI")


AOV_Tukey_VO2 <- aov(VO2 ~ ExpPhase*ZTgroup*Group, 
                      data = CLAMS_Comb) %>% tukey_hsd() %>%
  add_significance()


SummCLAMSComb <- summarise(CLAMS_Comb %>%
                    group_by(ExpPhase, ZTgroup, Group) %>%
                    drop_na(),
                    VO2 = mean(VO2),
                    VCO2 = mean(VCO2),
                    RER = mean(RER),
                    FEED = mean(FEED1),
                    DRINK = mean(DRINK1),
                    PA = mean(XTOT))

data <- SummCLAMSComb
knitr::kable(data,
caption = "Summary of group averages in CLAMS data PRE and POST LDI")


AOV_Tukey_VO2 <- aov(VO2 ~ ExpPhase*ZTgroup*Group, 
                      data = CLAMS_Comb) %>% tukey_hsd() %>%
  add_significance()

#####

DatC1andC2 <- CLAMS_Comb %>%
  select(3:10,12,13,18,19) %>%
  rename(mouse = pill,
         portion = ExpPhase,
         Light = ZTgroup) %>% group_by(mouse, Group, Light, portion)

SummC1andC2 <- summarise(DatC1andC2,
                         RER = mean(RER),
                         VO2 = mean(VO2),
                         VCO2 = mean(VCO2),
                         FEED = mean(FEED1),
                         DRINK = mean(DRINK1),
                         PA = mean(XTOT),
                         Group = Group,
                         Light = Light,
                         portion = portion) %>% unique()

# VO2
AOV_Tukey_VO2 <- aov(VO2 ~ portion*Light*Group, 
                      data = SummC1andC2) %>% tukey_hsd() %>%
  add_significance()

TwoWayTukey_C1C2_VO2_CTRL <- aov(VO2 ~ Light*portion, data = SummC1andC2 %>% filter(Group == "CTRL")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_VO2_CTRL[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VO2 in CTRL CLAMS1 vs CLAMS2")

TwoWayTukey_C1C2_VO2_RW <- aov(VO2 ~ Light*portion, data = SummC1andC2 %>% filter(Group == "RW")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_VO2_RW[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VO2 in RW CLAMS1 vs CLAMS2")

TwoWayTukey_CLRW_VO2_C1 <- aov(VO2 ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS1")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_VO2_C1[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VO2 in CLAMS1 CTRL vs RW")

TwoWayTukey_CLRW_VO2_C2 <- aov(VO2 ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS2")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_VO2_C2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VO2 in CLAMS2 CTRL vs RW")


SummC1andC2$Group <- factor(SummC1andC2$Group, levels = c("CTRL","RW"))
SummC1andC2$Light <- factor(SummC1andC2$Light, levels = c("LIGHT","DARK"))

bxp <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = VO2,
        color = portion))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "VO2") +
  ylim(2000,4000) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()
ggsave("VO2_CLAMS1and2.png")

bxpB <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = VO2,
        color = Group))

bxpB + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "VO2") +
  ylim(2000,4000) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()
ggsave("VO2_CTRLandRW.png")

# VCO2
AOV_Tukey_VCO2 <- aov(VCO2 ~ portion*Light*Group, 
                      data = SummC1andC2) %>% tukey_hsd() %>%
  add_significance()

TwoWayTukey_C1C2_VCO2_CTRL <- aov(VCO2 ~ Light*portion, data = SummC1andC2 %>% filter(Group == "CTRL")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_VCO2_CTRL[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VCO2 in CTRL CLAMS1 vs CLAMS2")

TwoWayTukey_C1C2_VCO2_RW <- aov(VCO2 ~ Light*portion, data = SummC1andC2 %>% filter(Group == "RW")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_VCO2_RW[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VCO2 in RW CLAMS1 vs CLAMS2")

TwoWayTukey_CLRW_VCO2_C1 <- aov(VCO2 ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS1")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_VCO2_C1[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VCO2 in CLAMS1 CTRL vs RW")

TwoWayTukey_CLRW_VCO2_C2 <- aov(VCO2 ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS2")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_VCO2_C2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for VCO2 in CLAMS2 CTRL vs RW")


SummC1andC2$Group <- factor(SummC1andC2$Group, levels = c("CTRL","RW"))
SummC1andC2$Light <- factor(SummC1andC2$Light, levels = c("LIGHT","DARK"))

bxp <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = VCO2,
        color = portion))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "VCO2") +
  ylim(2000,4000) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()
ggsave("VCO2_CLAMS1and2.png")

bxpB <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = VCO2,
        color = Group))

bxpB + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "VCO2") +
  ylim(2000,4000) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()
ggsave("VCO2_CTRLandRW.png")

# RER
AOV_Tukey_RER <- aov(RER ~ portion*Light*Group, 
                      data = SummC1andC2) %>% tukey_hsd() %>%
  add_significance()

TwoWayTukey_C1C2_RER_CTRL <- aov(RER ~ Light*portion, data = SummC1andC2 %>% filter(Group == "CTRL")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_RER_CTRL[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for RER in CTRL CLAMS1 vs CLAMS2")

TwoWayTukey_C1C2_RER_RW <- aov(RER ~ Light*portion, data = SummC1andC2 %>% filter(Group == "RW")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_RER_RW[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for RER in RW CLAMS1 vs CLAMS2")

TwoWayTukey_CLRW_RER_C1 <- aov(RER ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS1")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_RER_C1[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for RER in CLAMS1 CTRL vs RW")

TwoWayTukey_CLRW_RER_C2 <- aov(RER ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS2")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_RER_C2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for RER in CLAMS2 CTRL vs RW")

SummC1andC2$Group <- factor(SummC1andC2$Group, levels = c("CTRL","RW"))
SummC1andC2$Light <- factor(SummC1andC2$Light, levels = c("LIGHT","DARK"))

bxp <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = RER,
        color = portion))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "RER") +
  ylim(0.7,1) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()
ggsave("RER_CLAMS1and2.png")

bxpB <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = RER,
        color = Group))

bxpB + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "RER") +
  ylim(0.7,1) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()
ggsave("RER_CTRLandRW.png")

# FEED
AOV_Tukey_FEED <- aov(FEED ~ portion*Light*Group, 
                      data = SummC1andC2) %>% tukey_hsd() %>%
  add_significance()

TwoWayTukey_C1C2_FEED_CTRL <- aov(FEED ~ Light*portion, data = SummC1andC2 %>% filter(Group == "CTRL")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_FEED_CTRL[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for FEED in CTRL CLAMS1 vs CLAMS2")

TwoWayTukey_C1C2_FEED_RW <- aov(FEED ~ Light*portion, data = SummC1andC2 %>% filter(Group == "RW")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_FEED_RW[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for FEED in RW CLAMS1 vs CLAMS2")

TwoWayTukey_CLRW_FEED_C1 <- aov(FEED ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS1")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_FEED_C1[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for FEED in CLAMS1 CTRL vs RW")

TwoWayTukey_CLRW_FEED_C2 <- aov(FEED ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS2")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_FEED_C2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for FEED in CLAMS2 CTRL vs RW")


SummC1andC2$Group <- factor(SummC1andC2$Group, levels = c("CTRL","RW"))
SummC1andC2$Light <- factor(SummC1andC2$Light, levels = c("LIGHT","DARK"))

bxp <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = FEED,
        color = portion))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "FEED") +
  ylim(0,.1) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxpB <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = FEED,
        color = Group))

bxpB + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "FEED") +
  ylim(0,.1) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()


# DRINK
AOV_Tukey_DRINK <- aov(DRINK ~ portion*Light*Group, 
                      data = SummC1andC2) %>% tukey_hsd() %>%
  add_significance()

TwoWayTukey_C1C2_DRINK_CTRL <- aov(DRINK ~ Light*portion, data = SummC1andC2 %>% filter(Group == "CTRL")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_DRINK_CTRL[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for DRINK in CTRL CLAMS1 vs CLAMS2")

TwoWayTukey_C1C2_DRINK_RW <- aov(DRINK ~ Light*portion, data = SummC1andC2 %>% filter(Group == "RW")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_DRINK_RW[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for DRINK in RW CLAMS1 vs CLAMS2")

TwoWayTukey_CLRW_DRINK_C1 <- aov(DRINK ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS1")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_DRINK_C1[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for DRINK in CLAMS1 CTRL vs RW")

TwoWayTukey_CLRW_DRINK_C2 <- aov(DRINK ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS2")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_DRINK_C2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for DRINK in CLAMS2 CTRL vs RW")


SummC1andC2$Group <- factor(SummC1andC2$Group, levels = c("CTRL","RW"))
SummC1andC2$Light <- factor(SummC1andC2$Light, levels = c("LIGHT","DARK"))

bxp <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = DRINK,
        color = portion))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "DRINK") +
  ylim(0,.05) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxpB <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = DRINK,
        color = Group))

bxpB + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "DRINK") +
  ylim(0,.05) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()


# PA
AOV_Tukey_PA <- aov(PA ~ portion*Light*Group, 
                      data = SummC1andC2) %>% tukey_hsd() %>%
  add_significance()

TwoWayTukey_C1C2_PA_CTRL <- aov(PA ~ Light*portion, data = SummC1andC2 %>% filter(Group == "CTRL")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_PA_CTRL[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for PA in CTRL CLAMS1 vs CLAMS2")

TwoWayTukey_C1C2_PA_RW <- aov(PA ~ Light*portion, data = SummC1andC2 %>% filter(Group == "RW")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_C1C2_PA_RW[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for PA in RW CLAMS1 vs CLAMS2")

TwoWayTukey_CLRW_PA_C1 <- aov(PA ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS1")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_PA_C1[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for PA in CLAMS1 CTRL vs RW")

TwoWayTukey_CLRW_PA_C2 <- aov(PA ~ Light*Group, data = SummC1andC2 %>% filter(portion == "CLAMS2")) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_CLRW_PA_C2[c(1:4,7:8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for PA in CLAMS2 CTRL vs RW")


SummC1andC2$Group <- factor(SummC1andC2$Group, levels = c("CTRL","RW"))
SummC1andC2$Light <- factor(SummC1andC2$Light, levels = c("LIGHT","DARK"))

bxp <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = PA,
        color = portion))

bxp + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "PA") +
  ylim(0,2000) +
  facet_wrap(~Group) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()

bxpB <- ggplot(
    SummC1andC2,
    aes(x = Light,
        y = PA,
        color = Group))

bxpB + geom_boxplot(outlier.size = 0.2) +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red"
                                )) +
    labs(title = "CLAMS1 and CLAMS2",
         y = "PA") +
  ylim(0,2000) +
  facet_wrap(~portion) +
  font("title", size = 10, color = "black", face = "bold.italic") +
  font("xlab", size = 10, color = "black") +
  font("ylab", size = 10, color = "black") +
  font("xy.text", size = 10, color = "black") +
      theme_classic()



```

```{r generate CTRL VO2 time series}

StartDate <- as.Date("2024-02-04")
EndDate <- as.Date(StartDate) + 28

SeriesData <- CLAMS_Comb %>% filter(CorrectDate > StartDate & CorrectDate < EndDate)
#SeriesData$VO2test <- na.approx(SeriesData$VO2)

LDI_Date <- as.Date("2024-02-10")
SeriesPRELDI <- SeriesData %>% filter(CorrectDate < LDI_Date)

SeriesT0 <- SeriesCLAMS1 <- SeriesData %>% filter(ExpPhase == "CLAMS1")
SeriesT5 <- SeriesCLAMS2 <- SeriesData %>% filter(ExpPhase == "CLAMS2")

# Measurements were taken every 17 minutes. use frequency of 4 per hour and correct later by factor of 15/17 to adjust calculated Period and Phase.

Pill <- 9

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
##pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
##pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- ACFtib


Pill <- 10

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
##pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
##pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 11

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
##pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 12

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"



ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 13

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 14

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"



ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 15

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

```

```{r generate RW VO2 time series}

Pill <- 1

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"



ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- ACFtib


Pill <- 2

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"



ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 3

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"



ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 5

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 6

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 7

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"



ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 8

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT0$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VO2, Lightseries)
test <- mouseT5$VO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

```


```{r boxplot for VO2 by group, fig.height=2, fig.width=3}

ACF_ALL <- rbind(ACFcombCTRL,ACFcombRW)

SummACF <- summarise(ACF_ALL %>% group_by(group,portion),
                             meanPeriod = mean(PeriodACF),
                             sdPeriod = sd(PeriodACF),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))

TwoWayTukey_Period <- aov(PeriodACF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Period[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for period in CLAMS VO2 data")


TwoWayTukey_Phase <- aov(PhaseCCF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Phase[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for phase in CLAMS VO2 data")



ACF_ALL$portion <- factor(ACF_ALL$portion, levels = c("CLAMS1","CLAMS2"))

bxp_CBTperiodsB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PeriodACF,
        color = portion))

bxp_CBTperiodsB + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
    labs(title = "Periods CLAMS VO2",
         y = "Period") +
  #ylim(23,25.5)+
      theme_classic()

# Analysis of Phase from CCF


bxp_CBT_phase <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PhaseCCF,
        color = portion))

bxp_CBT_phase + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
  ylim(8,16) +
    labs(title = "Phase in CLAMS VO2",
         y = "Phase (ZT)") +
      theme_classic()

bxp_CBT_phaseB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = portion,
        y = PhaseCCF,
        color = group))

bxp_CBT_phaseB + geom_boxplot() +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red")) +
  ylim(10,14) +
    labs(title = "Phase CLAMS VO2",
         y = "Phase (ZT)") +
      theme_classic()

write_excel_csv(ACF_ALL, "PhaseCLAMS_VO2.xls")

```


```{r generate CTRL VCO2 time series}

StartDate <- as.Date("2024-02-05")
EndDate <- as.Date(StartDate) + 28

SeriesData <- CLAMS_Comb %>% filter(CorrectDate > StartDate & CorrectDate < EndDate)
#SeriesData$VCO2test <- na.approx(SeriesData$VCO2)

LDI_Date <- as.Date("2024-02-10")
SeriesPRELDI <- SeriesData %>% filter(CorrectDate < LDI_Date)

SeriesT0 <- SeriesData %>% filter(ExpPhase == "CLAMS1")
SeriesT5 <- SeriesData %>% filter(ExpPhase == "CLAMS2")

# Measurements were taken every 17 minutes. use frequency of 4 per hour and correct later by factor of 15/17 to adjust calculated Period and Phase.

Pill <- 9

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- ACFtib


Pill <- 10

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 11

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 12

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 13

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 14

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 15

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

```

```{r generate RW VCO2 time series}

Pill <- 1

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- ACFtib


Pill <- 2

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 3

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 5

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 6

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 7

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 8

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT0$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, VCO2, Lightseries)
test <- mouseT5$VCO2
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

```


```{r boxplot for VCO2 by group, fig.height=2, fig.width=3}

ACF_ALL <- rbind(ACFcombCTRL,ACFcombRW)

SummACF <- summarise(ACF_ALL %>% group_by(group,portion),
                             meanPeriod = mean(PeriodACF),
                             sdPeriod = sd(PeriodACF),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))

TwoWayTukey_Period <- aov(PeriodACF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Period[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for period in CLAMS VCO2 data")


TwoWayTukey_Phase <- aov(PhaseCCF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Phase[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for phase in CLAMS VCO2 data")



ACF_ALL$portion <- factor(ACF_ALL$portion, levels = c("CLAMS1","CLAMS2"))

bxp_CBTperiodsB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PeriodACF,
        color = portion))

bxp_CBTperiodsB + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
    labs(title = "Periods CLAMS VCO2",
         y = "Period") +
  #ylim(23,25.5)+
      theme_classic()

# Analysis of Phase from CCF


bxp_CBT_phase <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PhaseCCF,
        color = portion))

bxp_CBT_phase + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
  ylim(8,16) +
    labs(title = "Phase in CLAMS VCO2",
         y = "Phase (ZT)") +
      theme_classic()

bxp_CBT_phaseB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = portion,
        y = PhaseCCF,
        color = group))

bxp_CBT_phaseB + geom_boxplot() +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red")) +
    ylim(10,14) +
    labs(title = "Phase CLAMS VCO2",
         y = "Phase (ZT)") +
      theme_classic()


write_excel_csv(ACF_ALL, "PhaseCLAMS_VCO2.xls")

```




```{r generate CTRL RER time series}

StartDate <- as.Date("2024-02-05")
EndDate <- as.Date(StartDate) + 28

SeriesData <- CLAMS_Comb %>% filter(CorrectDate > StartDate & CorrectDate < EndDate)
#SeriesData$VCO2test <- na.approx(SeriesData$RER)

LDI_Date <- as.Date("2024-02-10")
SeriesPRELDI <- SeriesData %>% filter(CorrectDate < LDI_Date)

SeriesT0 <- SeriesData %>% filter(ExpPhase == "CLAMS1")
SeriesT5 <- SeriesData %>% filter(ExpPhase == "CLAMS2")

# Measurements were taken every 17 minutes. use frequency of 4 per hour and correct later by factor of 15/17 to adjust calculated Period and Phase.

Pill <- 9

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"

ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- ACFtib


Pill <- 10

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 11

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 12

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 13

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 14

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 15

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

```

```{r generate RW RER time series}

Pill <- 1

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- ACFtib


Pill <- 2

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 3

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 5

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 6

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 7

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 8

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT0$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, RER, Lightseries)
test <- mouseT5$RER
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

```


```{r boxplot for RER by group, fig.height=2, fig.width=3}

ACF_ALL <- rbind(ACFcombCTRL,ACFcombRW)

SummACF <- summarise(ACF_ALL %>% group_by(group,portion),
                             meanPeriod = mean(PeriodACF),
                             sdPeriod = sd(PeriodACF),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))

TwoWayTukey_Period <- aov(PeriodACF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Period[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for period in CLAMS RER data")


TwoWayTukey_Phase <- aov(PhaseCCF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Phase[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for phase in CLAMS RER data")



ACF_ALL$portion <- factor(ACF_ALL$portion, levels = c("CLAMS1","CLAMS2"))

bxp_CBTperiodsB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PeriodACF,
        color = portion))

bxp_CBTperiodsB + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
    labs(title = "Periods CLAMS RER",
         y = "Period") +
  #ylim(23,25.5)+
      theme_classic()

# Analysis of Phase from CCF


bxp_CBT_phase <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PhaseCCF,
        color = portion))

bxp_CBT_phase + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
  ylim(8,16) +
    labs(title = "Phase in CLAMS RER",
         y = "Phase (ZT)") +
      theme_classic()

bxp_CBT_phaseB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = portion,
        y = PhaseCCF,
        color = group))

bxp_CBT_phaseB + geom_boxplot() +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red")) +
  ylim(10,14) +
    labs(title = "Phase CLAMS RER",
         y = "Phase (ZT)") +
      theme_classic()

write_excel_csv(ACF_ALL, "PhaseCLAMS_RER.xls")

```


```{r generate CTRL FEED1 time series}

StartDate <- as.Date("2024-02-05")
EndDate <- as.Date(StartDate) + 28

SeriesData <- CLAMS_Comb %>% filter(CorrectDate > StartDate & CorrectDate < EndDate)
#SeriesData$FEED1test <- na.approx(SeriesData$FEED1)

LDI_Date <- as.Date("2024-02-10")
SeriesPRELDI <- SeriesData %>% filter(CorrectDate < LDI_Date)

SeriesT0 <- SeriesData %>% filter(ExpPhase == "CLAMS1")
SeriesT5 <- SeriesData %>% filter(ExpPhase == "CLAMS2")

# Measurements were taken every 17 minutes. use frequency of 4 per hour and correct later by factor of 15/17 to adjust calculated Period and Phase.

Pill <- 9

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- ACFtib


Pill <- 10

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 11

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 12

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 13

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 14

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 15

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

```

```{r generate RW FEED1 time series}

Pill <- 1

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- ACFtib


Pill <- 2

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 3

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 5

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 6

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 7

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 8

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT0$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, FEED1, Lightseries)
test <- mouseT5$FEED1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

```


```{r boxplot for FEED1 by group, fig.height=2, fig.width=3}

ACF_ALL <- rbind(ACFcombCTRL,ACFcombRW)

SummACF <- summarise(ACF_ALL %>% group_by(group,portion),
                             meanPeriod = mean(PeriodACF),
                             sdPeriod = sd(PeriodACF),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))

TwoWayTukey_Period <- aov(PeriodACF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Period[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for period in CLAMS FEED1 data")


TwoWayTukey_Phase <- aov(PhaseCCF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Phase[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for phase in CLAMS FEED1 data")



ACF_ALL$portion <- factor(ACF_ALL$portion, levels = c("CLAMS1","CLAMS2"))

bxp_CBTperiodsB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PeriodACF,
        color = portion))

bxp_CBTperiodsB + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "black",
                                "CLAMS2" = "darkgreen")) +
    labs(title = "Periods CLAMS FEED1",
         y = "Period") +
  #ylim(23,25.5)+
      theme_classic()

# Analysis of Phase from CCF


bxp_CBT_phase <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PhaseCCF,
        color = portion))

bxp_CBT_phase + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
  ylim(8,16) +
    labs(title = "Phase in CLAMS FEED1",
         y = "Phase (ZT)") +
      theme_classic()

bxp_CBT_phaseB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = portion,
        y = PhaseCCF,
        color = group))

bxp_CBT_phaseB + geom_boxplot() +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red")) +
  ylim(10,14) +
    labs(title = "Phase CLAMS FEED1",
         y = "Phase (ZT)") +
      theme_classic()

write_excel_csv(ACF_ALL, "PhaseCLAMS_FEED.xls")

```



```{r generate CTRL DRINK time series}

StartDate <- as.Date("2024-02-05")
EndDate <- as.Date(StartDate) + 28

SeriesData <- CLAMS_Comb %>% filter(CorrectDate > StartDate & CorrectDate < EndDate)
#SeriesData$DRINK1test <- na.approx(SeriesData$DRINK1)

LDI_Date <- as.Date("2024-02-10")
SeriesPRELDI <- SeriesData %>% filter(CorrectDate < LDI_Date)

SeriesT0 <- SeriesData %>% filter(ExpPhase == "CLAMS1")
SeriesT5 <- SeriesData %>% filter(ExpPhase == "CLAMS2")

# Measurements were taken every 17 minutes. use frequency of 4 per hour and correct later by factor of 15/17 to adjust calculated Period and Phase.

Pill <- 9

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- ACFtib


Pill <- 10

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 11

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 12

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 13

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 14

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)


Pill <- 15

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "CTRL"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "CTRL"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombCTRL <- rbind(ACFcombCTRL, ACFtib)

```

```{r generate RW DRINK1 time series}

Pill <- 1

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- ACFtib


Pill <- 2

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 3

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 5

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 6

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 7

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)


Pill <- 8

mouseT0 <- SeriesT0 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT0$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT0 <- plot(ts_mouse)
testL <- mouseT0$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T0acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T0acftib <- as_tibble(cbind(T0acf$lag,T0acf$acf))
colnames(T0acftib) <- c("hours","ACF")
T0acftib <- T0acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T0acftib$ACF)
PeriodACF <- T0acftib$hours[T0acftib$ACF == MAX]
T0acftib <- T0acftib %>% filter(hours == PeriodACF)
T0ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T0ccftib <- as_tibble(cbind(T0ccf$lag,T0ccf$acf))
colnames(T0ccftib) <- c("hours","ACF")
T0ccftib <- T0ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T0ccftib$ACF)
PhaseCCF <- T0ccftib$hours[T0ccftib$ACF == MAX] * 17/15
T0acftib$PeriodACF <- T0acftib$hours * 17/15
T0acftib$PhaseCCF <- PhaseCCF
T0acftib$group <- "RW"
T0acftib$portion <- "CLAMS1"

mouseT5 <- SeriesT5 %>% filter(pill == Pill) %>% 
  select(datetime_corr, DRINK1, Lightseries)
test <- mouseT5$DRINK1
ts_mouse <- ts(test, start = 1, frequency = 4, deltat = 1)
#pT5 <- plot(ts_mouse)
testL <- mouseT5$Lightseries
ts_light <- ts(testL, start = 1, frequency = 4, deltat = 1)
T5acf <- acf(ts_mouse, lag.max = 30*4, plot = FALSE)
T5acftib <- as_tibble(cbind(T5acf$lag,T5acf$acf))
colnames(T5acftib) <- c("hours","ACF")
T5acftib <- T5acftib %>% filter(hours > 18*15/17 & hours < 30*15/17)
MAX <- max(T5acftib$ACF)
PeriodACF <- T5acftib$hours[T5acftib$ACF == MAX]
T5acftib <- T5acftib %>% filter(hours == PeriodACF)
T5ccf <- ccf(ts_mouse, ts_light, lag.max = 30 * 12, plot = FALSE)
T5ccftib <- as_tibble(cbind(T5ccf$lag,T5ccf$acf))
colnames(T5ccftib) <- c("hours","ACF")
T5ccftib <- T5ccftib %>% filter(hours > 0 & hours < 24)
MAX <- max(T5ccftib$ACF)
PhaseCCF <- T5ccftib$hours[T5ccftib$ACF == MAX] * 17/15
T5acftib$PeriodACF <- T5acftib$hours * 17/15
T5acftib$PhaseCCF <- PhaseCCF
T5acftib$group <- "RW"
T5acftib$portion <- "CLAMS2"


ACFtib <- rbind(T0acftib,T5acftib)
ACFtib$mouse <- Pill
ACFcombRW <- rbind(ACFcombRW, ACFtib)

```


```{r boxplot for DRINK1 by group, fig.height=2, fig.width=3}

ACF_ALL <- rbind(ACFcombCTRL,ACFcombRW)

SummACF <- summarise(ACF_ALL %>% group_by(group,portion),
                             meanPeriod = mean(PeriodACF),
                             sdPeriod = sd(PeriodACF),
                             meanPhase = mean(PhaseCCF),
                             sdPhase = sd(PhaseCCF))

TwoWayTukey_Period <- aov(PeriodACF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Period[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for period in CLAMS DRINK1 data")


TwoWayTukey_Phase <- aov(PhaseCCF ~ group*portion,
                            data = ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2"))) %>% tukey_hsd() %>% add_significance()

data <- TwoWayTukey_Phase[c(1:4,7,8), c(1:3,8:9)]
knitr::kable(data,
caption = "Two-way ANOVA for phase in CLAMS DRINK1 data")



ACF_ALL$portion <- factor(ACF_ALL$portion, levels = c("CLAMS1","CLAMS2"))

bxp_CBTperiodsB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PeriodACF,
        color = portion))

bxp_CBTperiodsB + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "black",
                                "CLAMS2" = "darkgreen")) +
    labs(title = "Periods CLAMS DRINK1",
         y = "Period") +
  #ylim(23,25.5)+
      theme_classic()

# Analysis of Phase from CCF


bxp_CBT_phase <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = group,
        y = PhaseCCF,
        color = portion))

bxp_CBT_phase + geom_boxplot() +
  scale_color_manual(values = c("CLAMS1" = "gray",
                                "CLAMS2" = "blue")) +
  ylim(8,16) +
    labs(title = "Phase in CLAMS DRINK1",
         y = "Phase (ZT)") +
      theme_classic()

bxp_CBT_phaseB <- ggplot(
    ACF_ALL %>% filter(portion %in% c("CLAMS1","CLAMS2")), 
    aes(x = portion,
        y = PhaseCCF,
        color = group))

bxp_CBT_phaseB + geom_boxplot() +
  scale_color_manual(values = c("CTRL" = "black",
                                "RW" = "red")) +
  ylim(10,14) +
    labs(title = "Phase CLAMS DRINK1",
         y = "Phase (ZT)") +
      theme_classic()

write_excel_csv(ACF_ALL, "PhaseCLAMS_DRINK.xls")

```


``` {r Plot CLAMS1 data by group with shading to indicate lights on and off, eval=TRUE, echo=FALSE, include=TRUE}

DatI <- SeriesCLAMS1 %>% filter(CorrectDate > "2024-02-04" & 
                                             CorrectDate < "2024-02-10") #%>% select(3,4,5,8,9,10)

DatIrounded <- DatI
DatIrounded$datetime_corr <- round_date(DatIrounded$datetime_corr, "17 minutes")

DatIgrouped <- DatIrounded %>% group_by(Group,datetime_corr) %>%
  mutate(Light = ifelse(ZTgroup == "LIGHT", "ON", "OFF"))

DatIsumm <- summarise(DatIgrouped,
                      VO2avg = mean(VO2),
                      sd = sd(VO2),
                      Light = Light)

Dat <- DatIsumm

ggplot() +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_line(data = Dat,
            aes(x = datetime_corr, y = VO2avg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('VO2') +
  labs(title = paste("Average VO2 for each group"),
       subtitle = "CLAMS1")



#VCO2

DatIsumm <- summarise(DatIgrouped,
                      VCO2avg = mean(VCO2),
                      sd = sd(VCO2),
                      Light = Light)

Dat <- DatIsumm

ggplot() +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_line(data = Dat,
            aes(x = datetime_corr, y = VCO2avg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('VCO2') +
  labs(title = paste("Average VCO2 for each group"),
       subtitle = "CLAMS1")

# RER

DatIsumm <- summarise(DatIgrouped,
                      RERavg = mean(RER),
                      sd = sd(RER),
                      Light = Light)

Dat <- DatIsumm

ggplot() +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_line(data = Dat,
            aes(x = datetime_corr, y = RERavg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('RER') +
  labs(title = paste("Average RER for each group"),
       subtitle = "CLAMS1")


# FEED1

DatIsumm <- summarise(DatIgrouped,
                      FEED1avg = mean(FEED1),
                      sd = sd(FEED1),
                      Light = Light)

Dat <- DatIsumm

ggplot() +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_line(data = Dat,
            aes(x = datetime_corr, y = FEED1avg, color = Group), linewidth=0.3) +
  ylim(0,0.2) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('FEED1') +
  labs(title = paste("Average FEED1 for each group"),
       subtitle = "CLAMS1")


# DRINK1

DatIsumm <- summarise(DatIgrouped,
                      DRINK1avg = mean(DRINK1),
                      sd = sd(DRINK1),
                      Light = Light)

Dat <- DatIsumm

ggplot() +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-05 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-05 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-06 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-06 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-06 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-06 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-07 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-07 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-07 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-07 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-08 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-08 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-08 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-08 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-09 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-09 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
    geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-09 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-10 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-09 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-10 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_line(data = Dat,
            aes(x = datetime_corr, y = DRINK1avg, color = Group), linewidth=0.3) +
  ylim(0,.05) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('DRINK1') +
  labs(title = paste("Average DRINK1 for each group"),
       subtitle = "CLAMS1")
```



``` {r Plot CLAMS2 data by group with shading to indicate lights on and off, eval=TRUE, echo=FALSE, include=TRUE}

DatII <- SeriesCLAMS2 %>% filter(CorrectDate > "2024-02-26" & 
                                             CorrectDate < "2024-03-03")

DatIIrounded <- DatII
DatIIrounded$datetime_corr <- round_date(DatIIrounded$datetime_corr, "17 minutes")

DatIIgrouped <- DatIIrounded %>% group_by(Group,datetime_corr) %>%
  mutate(Light = ifelse(ZTgroup == "LIGHT", "ON", "OFF"))


#VO2

DatIIsumm <- summarise(DatIIgrouped,
                      VO2avg = mean(VO2),
                      sd = sd(VO2),
                      Light = Light)

Dat <- DatIIsumm

ggplot() +
      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 02:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-03 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-03 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 14:55:00 UTC"),
                 ymin=2000,
                 ymax=4500,
                 fill=factor(Light)))) +  
  geom_line(data = Dat,
            aes(x = datetime_corr, y = VO2avg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('VO2') +
  labs(title = paste("Average VO2 for each group"),
       subtitle = "CLAMS2")



#VCO2

DatIIsumm <- summarise(DatIIgrouped,
                      VCO2avg = mean(VCO2),
                      sd = sd(VCO2),
                      Light = Light)

Dat <- DatIIsumm

ggplot() +
      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 02:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-03 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-03 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 14:55:00 UTC"),
                 ymin=1500,
                 ymax=4000,
                 fill=factor(Light)))) +  
  geom_line(data = Dat,
            aes(x = datetime_corr, y = VCO2avg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('VCO2') +
  labs(title = paste("Average VCO2 for each group"),
       subtitle = "CLAMS2")


# RER

DatIIsumm <- summarise(DatIIgrouped,
                      RERavg = mean(RER),
                      sd = sd(RER),
                      Light = Light)

Dat <- DatIIsumm

ggplot() +
      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 02:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-03 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-03 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 14:55:00 UTC"),
                 ymin=0.7,
                 ymax=1.1,
                 fill=factor(Light)))) +  
  geom_line(data = Dat,
            aes(x = datetime_corr, y = RERavg, color = Group), linewidth=0.3) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('RER') +
  labs(title = paste("Average RER for each group"),
       subtitle = "CLAMS2")


# FEED1

DatIIsumm <- summarise(DatIIgrouped,
                      FEED1avg = mean(FEED1),
                      sd = sd(FEED1),
                      Light = Light)

Dat <- DatIIsumm

ggplot() +
      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 02:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-03 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-03 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 14:55:00 UTC"),
                 ymin=0,
                 ymax=0.2,
                 fill=factor(Light)))) +  
  geom_line(data = Dat,
            aes(x = datetime_corr, y = FEED1avg, color = Group), linewidth=0.3) +
  ylim(0,0.2) +
    scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('FEED1') +
  labs(title = paste("Average FEED1 for each group"),
       subtitle = "CLAMS2")


# DRINK1

DatIIsumm <- summarise(DatIIgrouped,
                      DRINK1avg = mean(DRINK1),
                      sd = sd(DRINK1),
                      Light = Light)

Dat <- DatIIsumm

ggplot() +
      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-26 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-26 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  scale_fill_manual(values=c("ON" = "white","OFF" = "lightgray"),
                    guide=FALSE) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-27 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-27 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-27 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-27 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-28 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-28 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-28 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-28 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-02-29 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-02-29 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-02-29 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-02-29 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-01 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-01 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-01 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-01 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-02 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-02 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +

      geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-02 15:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 02:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-02 15:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 02:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +
  geom_rect(data=Dat %>% filter(datetime_corr > as.POSIXct("2024-03-03 03:05:00 UTC") & datetime_corr 
                                < as.POSIXct("2024-03-03 14:55:00 UTC")),
            (aes(xmin=as.POSIXct("2024-03-03 03:05:00 UTC"),
                 xmax=as.POSIXct("2024-03-03 14:55:00 UTC"),
                 ymin=0,
                 ymax=.05,
                 fill=factor(Light)))) +  
  geom_line(data = Dat,
            aes(x = datetime_corr, y = DRINK1avg, color = Group), linewidth=0.3) +
  ylim(0,.05) +
  scale_color_manual(values = c("CTRL" = "black", "RW" = "red")) +
  ylab('DRINK1') +
  labs(title = paste("Average DRINK1 for each group"),
       subtitle = "CLAMS2")

```

